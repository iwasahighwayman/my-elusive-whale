# my-elusive-whale

A journey to build more environmentally-friendly LED lighting ... which turned into an obsession

THE INFORMATION IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE INFORMATION OR THE USE OR OTHER DEALINGS IN THE INFORMATION.

![Illuminated LED Lighting](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-IMG_0114-led-lights-illuminated-20220226.JPG)

# How on earth did I get here?

The last thing I remember hearing before tumbling down the hole was "_I'm late, I'm late! For a very important date! No time to say 'hello, goodbye,' I'm late, I'm late, I'm late!_".

We added a small covered open-air sitting area over our patio, and thought it would be nice to add some lighting for when sitting outside in the evening.  It was a conscious decision to not add outdoor electricity, to stay within budget and maintain the aesthetics.  The sitting area faces north, and gets very little sunlight, particularly during winter; initially solar-powered lighting did not seem like an option, but more on that later.

So the conclusion was to purchase some battery-powered LED lighting.  The product needed to be designed for outdoor usage, across all seasons' temperatures, and reasonably waterproof.  Optionally detecting darkness to turn on the lighting would be ideal, but the product must have a built-in timer, to extend the life of the batteries vs. the lighting on through the night.  Finally, the larger the battery type, the better.

Oh, and the product needed to be modestly priced, as I would need multiple strands of lighting to achieve the desired effect.  Plus being outdoors, invariably there would be failures that would need replacements.

# Iteration #1: Purchase batteries in bulk

In the end, most of the requirements could be met, but not all of them.  I found an LED lighting unit which does not have the darkness-on, but it does have a 6-hour on -and- 18-hour off timer.  It is designed for outdoor use and is reasonably sturdy and waterproof.

There are multiple lighting modes, such as alternating blinking, fade in and out, flashing which was just annoying and steady-on.

Being a simple man, we went with steady-on.

The lighting unit is operated by three "AA" batteries, at 4.5 Volts total.

In order to wrap around the two outdoor columns, plus across the span crossbeam, I needed a total of three LED lighting units.

I wondered: how long can three batteries last with LED lights steady-on for six hours each day.

I was somewhat surprised that the batteries actually lasted for about one month.

At first I thought "_That's not too bad ..._", swapped in three fresh "AA" batteries, times three lighting units so nine batteries total, reset the timer, and we were back in business.

But after a few months, I had this not-so-small pile of dead "AA" batteries.  Our town has a yard where they can be properly disposed, so we dropped them off.

A little while later, I sort-of felt guilty about the waste.

Being a degreed Electrical Engineer, there was only one thing to do: find a better way.

"_There must be a way to convert these LED lighting units to solar._"

But how?  I still have the same problem: minimal direct sunlight on the north-facing side of the house.  And mounting a solar panel in such a way to obtain the needed sunlight would either be aesthetically-unpleasant, and most-likely susceptible to damage in high winds, ice/snow storms, and other inclement weather.

I also discovered how expensive good solar panels with high holding capacity can cost!

"_There must be a way ..._"

So I did something completely out of character for me: I set the problem aside and focused on other projects which were interesting and would help me maintain some semblance of sanity during the COVID-19 lockdown.  My normal modus-operandi is to just press harder on the challenge until victory, but instead I decided to just take a break from all this.

# The first of potentially many tangential detours ... 

The holidays were approaching, and we didn't want our house to look like the Grinch lived here.  The front of our house faces south, and gets soaked with sunshine even in the winter - even more-so with snow providing reflection of the sunlight.

So time to purchase more LED lighting, with all the same requirements as for the back patio area lighting, except would be powered by solar.

To my pleasant surprise, I was able to find an LED lighting unit which met all the requirements, including darkness-on with a timer.

A couple pictures:

![Solar powered LED lighting - boxed](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-IMG_0216-solar-cell-led-lights-boxed-20220827.jpeg)

![Illuminated LED lighting - contents](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-IMG_0217-solar-cell-led-lights-in-box-20220827.jpeg)

It even came with a remote control.

"_A what?_"

A remote control.

![Solar powered LED lighting - remote control](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-IMG_0219-solar-cell-led-lights-remote-control-20220828.jpeg)

"_I'm a simple man ... why on earth do I need a remote control for my outdoor lighting?_"

But there it was.  I even tried to find a simpler, even less expensive product sans remote control.

Nope ... "_No soup for you!_" ... Take it with the remote control or move along.

Sigh ... OK.

We had gotten a cold spell just before the front yard LED lights arrived.  Most other homes already had their holiday lights installed.  I swear I heard one of the younger kids in the neighborhood, while waiting for the school bus, say "_Mommy, does the Grinch live in that house?_" to-which she replied "_Yes, I believe he does._"

OK, time to get busy.

The solar LED lights arrived a couple days later, just enough time for the ground to freeze into granite.  I unboxed the lights, which came with a small, say 6 inch, plastic spike which goes into the ground, and then there is an adjustable mounting bracket which goes from the spike to the solar cell which powers and controls the lighting.

I went outside, stretched out all the LEDs all over the front yard to untwist the wires, then knelt down to push the spike into the ground.  I mentioned the cold spell right?  "_Hmmm ... ground's pretty hard from the cold_".

I carefully inspected the plastic spike.  It seemed pretty sturdy.  "_It's probably just the very top of the ground that's frozen, so I'll just apply steadily increasing pressure until this spike breaks through to soft soil_".

I was using my normal modus operandi.

"_SNAP!!!_"

Sigh.

However, I had purchased a spare lighting unit for the front yard.  In our house, we have a saying: "_Pair and a spare_".  So I went inside and opened another lighting unit package.  I got the largest, scariest screwdriver I own, a hammer, and for good measure but thankfully unnecessary, the propane torch.  I will not be defeated by cold weather!  After creating a pilot hole, with the screwdriver and hammer, I successfully installed the front solar lights, coiling the LEDs artistically around the front bushes (it actually required two strings of lights to propose a nice display.)

That night I went to the window, and was shocked to discover that there was NO illumination!

"_A-Ha_" I said: I bet the battery in the solar cell was not charged, and I installed the lighting mid-late day.  Sure enough, the next evening we had lighting.

A couple days later: "_Mommy, did the Grinch move out of that house over there?_", to-which she replied "_Yes, I believe he did._"

A few days went by and we got our first snowfall.  I thought "_Our front lights will look so nice!_", and they did that evening.

And the next.

The third evening I went to the front window to admire my hard work and ... nothing.

No illumination reflecting gently against the evening snow.

Everyone other house's lights were on (I can already hear that kid saying "_Mommy ..._").

It was late, cold, and really no reason to go outside now in the darkness.  Better to mount an investigation in the morning.

The next day, the issue was apparent: the snow we received covered most of the solar cell, so no sunlight was getting to it.  You see, the plastic spike may be 6 inches long, but most of it goes into the ground, essentially placing the solar cells at ground level.  Add a few inches of snow and voila', no sunshine recharging the internal battery, thus no illumination.

No problem: I'll simply unbury the solar cell with my snow shovel, wide enough to ensure maximum sunlight hitting it.

I grabbed my trusty shovel, began carefully scraping back the snow to try to expose the solar cell.  Victory!

Remember how I mentioned earlier that it took two strings of lighting to get the desired effect: no problem, I'll just dig-out the other solar cell from the snow, so it can charge it's battery also.

"_Hmmm ... I think the other solar cell is right about here, so I'll just gently push the snow shovel like this until I feel the spike_"

I forgot that cold temperatures make plastic brittle.

"_SNAP!!!_"

Sigh.

OK.  I actually have one more set of lighting, and I'll use the spike from that package to replace the one I just broke.

Bingo.

That evening, I was rewarded with illumination.  Victory.  I will not be defeated.  Take that kid.

And then it snowed again.

Three days later: nothing.  Nada.  Darkness.

Not to be deterred, the answer was obvious:

![Front yard elevated solar panels](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-IMG_0111-solarcells-on-dowels-outside-20220226.JPG)

# Returning to the main road, for now ... 

The holidays were, well, strange ... due to COVID.  We did manage to carefully spend time with some family, but as with everyone in the world, we were all impacted, and not in a good way.

With some spare time after the holidays, I returned to my back yard lighting conundrum.  How to obtain back yard patio illumination while being environmentally friendly and responsible?

# Iteration #2A: Hacking the solar panel

Stand-alone solar cells were pretty expensive, though had impressive charge capacity thus long light.  But even if I make that investment, I really have no aesthetic and durable installation mechanism.  Thinking back on the front yard saga, an answer was immediately: "_Might it be possible to find some way to use the front yard solar cells to power the back yard LED lights?_"

After all, I have two front yard lighting sets' solar cells which have two broken spikes ... maybe I can use those ... somehow?

Engineers who I know only love one thing more than creating something ... and that's taking something someone else created, cracking it open, and figuring out how it works.  Gold medal to the engineer who can also put it all back together and it still works, albeit with the obligatory "_one apparently extra and unnecessary screw still sitting on the workbench_" outcome, which for many of us is unavoidable.

Grabbing a less-scary screwdriver, I carefully opened one of the spare solar cells.  To my joy, it was relatively straight-forward to reverse-engineer (AKA "Hack").  I pretty quickly discovered that it was not difficult to remove a few mechanical and electronic components, isolating most of the electronics that ran the front yard lights (including the remote control receiver circuitry ... I still say "_Really?_"), producing a simple solar powered battery charger.

![Hacked solar panel battery charger](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-IMG_0001-solarcell-hacking-01-20210511.JPG)

![Hacked solar panel battery charger](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-IMG_0006-solarcell-hacking-02-20210511.JPG)

![Hacked solar panel battery charger](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-IMG_0008-solarcell-hacking-03-20210511.JPG)

![Hacked solar panel battery charger](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-IMG_0014-solarcell-hacking-04-20210511.JPG)

![Hacked solar panel battery charger](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-IMG_0112-solarcell-hacking-05-20220226.JPG)

I really wanted to ensure that I understood the solar cell, and particularly the charging circuit for the Lithium Ion (Li-Ion) battery.  After spend more time researching for the integrated circuit than I should admit to (it was around 5 hours, but it was a snowy day and nothing else to do), I actually have relatively high confidence that I found the IC.  Please see the "datasheets" folder for the IC's PDF.  The datasheet's sample circuitry matched the solar cell's printed circuit board layout and passive components.  Given the cost of the solar cell lighting, I knew the IC must be dirt-cheap, and it is.

I contacted the manufacturer of the solar cell lighting, inquiring about the capacity of the internal Li-Ion battery.  After a couple days, I was informed that the battery has a capacity of 1200 milliamp-hours (mAH).

# Iteration #2B: Voltage conversion experimentation

Now armed with this information, it was time to design the power distribution from the front yard solar cells, to the back yard LED lighting.

First challenge: the back yard LED lighting was designed to run from three "AA" batteries thus 4.5 Volts.  But Li-Ion batteries have a lower 3.9 - 4.1 Volts level.  I therefore needed to do a voltage transformation to get to the necessary 4.5 Volts.

My first attempt was to place two hacked solar panels in parallel, then connect them thru the obligatory forward-bias diodes to prevent one solar cell's battery back-feeding the other solar cell's battery.  The diodes are critical for parallel-connected DC power sources, as their drain rates are never perfectly equal, and in a worst-case situation the absence of diodes can lead to overheating and possibly the smell of melting plastic and silicon.

I found a small, relatively efficient boost (step-up) voltage switching converter, calibrated it to 4.5 Volts output and began running my power delivery duration tests.  Each morning, I would place the solar panels out on the front steps, to be charged through the day.  Then that evening, I would connect the solar cells as described to a single spare back yard LED lighting unit, monitoring the converter voltage through the evening into the next day.

The LED lighting unit consumes approximately 100 milliamps (mA), so theoretically each 1200 milliamp-hour solar cell battery should supply about 12 hours of power, so for two batteries that should be about 24 hours.

Such idealized math rarely works out in the real world, and this was the case here.

Repeated experiments over a couple weeks showed that after about 14 hours, the solar cell batteries would begin to deplete and their voltage would drop.  The LEDs would begin to dim, and by 18 hours, the solar cell batteries had no charge left.

The problem is that the required diodes drop approximately 1/2 Volt, with 100 mA flowing through each diode.  That's pure wasted power.  And the switching boost voltage convert probably had an efficiency rating of perhaps 90-ish percent, so again more wasted power.

And in the back yard, I have three LED lighting units, each consuming 100 mA.

With this battery configuration, the front yard solar cells and batteries would only power the back yard LED lighting for one evening.  Solar cells have been around since the 1960's, so there has been a lot of time to improve them to require less and less sunlight to produce an equivalent power output.  If the next day was overcast, the batteries would still mostly or fully charge.  But if the next day was very cloudy and very little sunshine, then no LED illumination that evening.

Time to try something different ...

Buck (step-down) switching voltage converters tend to be a little more efficient than their boost cousins.

![Buck step-down switching voltage converter](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-IMG_0113-voltage-buck-down-converter-20220226.JPG)

So now if instead I configure the solar cell batteries to be in series, I can eliminate the need of the two diodes (and their associated power waste).

The resultant 4.1 x 2 or 8.2 Volt power supply was then bucked down to 4.5 Volts, and the experiments were repeated.

After a few rounds of "charge all day" then "drain all night" over the course of a week or so, the single spare back yard LED lighting unit consuming 100 mA would operate at 4.5 Volts for 21 or 22 hours.

So when dividing that time window by three, for the three actual back yard LED lighting units running for six hours, the solar cell batteries should still have some charge remaining the next morning.

# Iteration #2C: Electrical transmission lines

In order to get the front yard solar cell batteries' power to the back yard LED lighting units, I'll need to run some two-conductor insulated wire.

Determining the optimal diameter of the wire, called the "gage", specifically "American wire gage" (AWG), is part science and part art.

The smaller the gage number, the larger the wire diameter, and the lower power loss due to the wire.

But as the gage size increases, the wire gets more expensive and more stiff and difficult to handle.

Plus although low voltage, the wire will be outside so I wanted double-insulated conductors.

After performing some calculations, and then reading some reviews, I settled on using 22 AWG twisted copper wire.

Toilette paper was definitely not the only supply chain disrupted during COVID, though it certainly got the most news coverage.

I began searching all the likely distribution channels for a 100 foot coil of 22 AWG wire, and began to panic.

"_Out of stock_"

"_Unavailable for the foreseeable future_"

"_Would you like to be placed on the backorder list?_"

No I don't want to be on the backorder list ... I just want to purchase my spool of wire!

Finally after more patient searching, I found a spool, and I should receive it in a couple days.  Without looking too closely, I added it to my online shopping cart and proceeded to checkout.

Then I saw the total bill.

"_Are you kidding me?!?!_"

Sigh ... I made the purchase, rationalizing that even with this gouging, I really had no alternative, and this next phase of my project would keep me sane during COVID and was still less expensive than a good therapist.

# Iteration #2D: Architecture decisions

My wire arrived on the scheduled day mid-week, but I knew this was going to turn into an all-day ordeal running and connecting the wire.

And whatever you do, make sure you measure not twice but three or four times, before cutting the wire to length!

First I installed the buck voltage converter into a relatively waterproof enclosure (more on that later):

![Hacked solar panel battery charger](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-IMG_0206-buck-down-voltage-converter-in-enclosure-20220827.jpeg)

I placed the converter enclosure in the front yard, elevated by a couple bricks to try to keep it out of the snow, and connected the solar cells.

I then ran my 22 AWG wire up to a waterproof termination/distribution box in the back yard, on the ground on the north side of the west column, which would take in the power wire from the front yard voltage converter enclosure and connect that to three smaller, more discreet wires that would be fed to each of the three LED lighting units mounted on the columns of the covered patio area.

When I originally attached the LED lighting controllers to the columns, I had a "50-50 shot" as to which column the unit with the LEDs spanning the crossbeam should be mounted.  This was all done back when I was using the "AA" batteries, so the choice did not seem too relevant.

As you've probably guessed: the crossbeam LED light controller (and east column controller) were mounted on the east column, and the solar cell power wire and distribution enclosure were at the base of the west column.

Now, this sounds like a small concern, but turned out to be "_a significant (bad) decision which would prove to be difficult and labor-intensive to refactor_".

This is called an "_Architecture Decision_" ... and I blew it.

The covered patio area is actually quite tall.  In order to run the LED lighting, I needed to use my 9 foot wooden (AKA weighs a ton) step ladder.  Once again I dragged it out of the garage and around to the back yard, so that I could run the smaller, more discreet and aesthetic wire along the crossbeam and down to now two LED lighting controllers, mounted on the east column.  The entire effort took close to an hour, to make things look nice.

Next, I stripped the smaller, more discreet wires, to begin connecting them to the two east column hanging LED controllers.

Upon stripping the insulation, I noticed the actual copper wire itself was awfully small in diameter.  You see, I purchased a 50 foot white telephone extension wire.  Telephone wire has historically been 26 AWG, but these copper strands were definitely far smaller.

So now I'm concerned about the voltage drop occurring as now not one but two LED controllers, at 100 mA each or 200 mA total, would be traversing this tiny pair of wires.

I temporarily alligator-clipped the two LED controllers to the tiny pair of wires, and sure enough, instead of 4.5 Volts, the controllers were receiving 3.75 Volts, wasting almost 25% of the needed power across the tiny pair of wires.

But it was now mid-afternoon, and bitter cold in early February.  I could just barely feel the tips of my fingers, so I chose to move forward as-is, and complete the hookups of the LED controllers, and see how the lights' brightness looked that night after dark.

# Iteration #2E: Soldering iron gymnastics

I contemplated multiple ways to connect the power wires to the LED controllers.

I made the decision that there's "_no going back to battery-powered_" operation.

So I ran an extension cord, and got my trusty soldering iron.

The LED controller boxes for the lights that ran up the columns were located near the bottom of the columns (high enough in elevation to be above the snowline of a typical snow storm).  I soldered the power wires to the battery springs inside the LED controller enclosure.  It was a difficult job holding the wire and enclosure still with one hand, and then feed the solder into the soldering iron tip pressed against the wire and springs.  After some trial and error, manual dexterity prevailed, albeit with a few splatters of bright silver solder onto our dark gray patio stones.  I discovered for the smaller splatters, I could use my pocket knife to lift the splatters completely.  But for one larger splatter, there would remain some small remnant of the splatter probably forever.

The crossbeam LED lights controller was mounted higher up on the east column.  I was not comfortable soldering from the large, heavy 9 foot step ladder, so I put it back into the garage and instead used a two-step step stool.  I then set forth, balancing on the step stool, to perform the same soldering technique.  I turned out the step stool proved to make things feel far more rickety, and I realized I was applying far too much solder to the iron, with this ever-growing ball of bright silver solder hanging precariously off the end of the iron, over my dark gray stones.

Now, you need to understand that solder melts between 350 and 400 degrees fahrenheit.

And it was a human, natural reaction when I saw the ball of solder drip off the iron, headed towards the patio stones.

After yelling "_No!_", I did what nobody should do: I reached out my (ungloved) hand and caught the white-hot solder.

Remember how earlier I mentioned that it was a bitter cold day, growing even colder as the sun began to set.  I'm not sure if not being able to feel my fingers made the situation better or worse, but upon smelling burning flesh, my hand reflexed and I threw the solder off the patio and into the snow.  I flung the soldering iron away from me, nearly fell off the step stool, and ran for the snow bank and plunged my hand into it.

After catching my breath, and giving my hand a chance to start working again, I did successfully manage to make the final solder connections to the third and last LED controller.

It was nearly dark, and my hand ached.  I put the soldering iron, step stool and other items away.

It was time for a "_quarantini_" and see the results of my now solar powered back yard LED lights.

# Iteration #2F: Soldering iron gymnastics - round two

Well, as you can imagine, it was visibly apparent that the east column and crossbeam LED lights were dimmer than the west column lights, due to the voltage drop across the tiny telephone extension wires.

The 22 AWG wire used to go from the front yard solar cells and batteries, to the three back yard LED lights, was just too thick in diameter ... and given every foot the white outer insulation had dark black lettering with the manufacturer's information ... it would just be too visible and ugly to use across the crossbeam.

I searched for white, thin wire in 26 AWG, but none was to be found, let alone without manufacturer's lettering.

What could I do?

In the words of Pooh: "_Think think think ..._"

And then it came to me: telephone extension wires come in both two conductor (red and green) and four conductor (red, green, yellow and black) versions.  I originally purchased and strung two conductor telephone wire, which resulted in a 0.75 Volt drop.  If instead I use four conductor telephone wire, and use two conductors twisted together at both ends to carry the positive power, and the other two conductors twisted together at both ends to carry the neutral/ground power, then theoretically that should halve the resistance.  Instead of a 0.75 Volt drop, it should be more like 0.38 Volt drop.  Not ideal but better.

I was able to find and purchase a 50 foot length of white four conductor telephone wire, with no manufacturer lettering.  It was reasonably priced and arrived in a few days.

Before dragging the overweight wooden 9 foot step ladder back out of the garage, and go thru the effort of replacing the two conductor telephone wire with the four conductor telephone wire, I did an experiment.  I measured out the necessary four conductor telephone wire length, measuring three times before cutting.  I then twisted the ends and tested an extra pair of LED lighting units, with a 4.5 Volt supply on the hobby bench.  Sure enough, upon turning on the two LED lighting units, the power to them dropped to about 4.1 Volts, as anticipated.

Armed with these results, I took to the task of collecting the heavy 9 foot step ladder, de-soldering the two conductor telephone wire, removed it and replaced it with the four conductor telephone wire, and re-soldered everything.

Darkness arrived and I turned on the three LED lights.  To my satisfaction, even though the east column and crossover lights had a lower voltage than the west column, all three illuminated with a similar brightness.

# Iteration #3: Time for a complete refactor

The three solar cell powered back yard LED light string ran relatively well thru most of winter and mid-spring.  Once in a while we would get a few very cloudy days in a row, resulting in no light show after a couple nights, but it was infrequent enough to just turn the lights back on after the first sunny day.

But then I noticed that although the LEDs would illuminate once I went out to the patio and turn them on, they would only glow for an hour or two then go dark.

I assumed that after about a year and a half of repeated daily solar cell charging and evening LED lighting discharging of the solar cell's internal Li-Ion batteries, the batteries were starting to fail to hold a charge.

I still felt pretty good about my little odyssey: the two solar cell Li-Ion batteries are about the size of two "C" cell batteries.  Had I simply used three sets of three "AA" batteries over 18 months, that would have been 9 x 18 or over 160 "AA" batteries taken to the town yard for disposal.

BTW, I neglected to mention early-on: rechargeable "AA" batteries do not have nearly the milliamp-hour capacity of a normal alkaline battery.  By my calculations, would have needed three sets of nine rechargeable, plus the actual charging unit.  My calculations showed that every 2nd or at most 3rd evening, I would need to swap out nine depleted rechargeable "AA" batteries for freshly charged ones.  That would grow old quickly.

Spring was moving towards summer, the days were getting longer, and the absence of evening illumination to chase away the drearies was less of a concern.

Finally, one weekend day I had nothing particular to do, so I decided to check out the lighting and see if I could figure out what was wrong.  I took out both a voltmeter, and even a small portable digital oscilloscope.  The voltage readings and waveforms were totally screwy.  After some poking and prodding, I discovered the problem: one of the LED lighting controllers had gone bad, and was essentially powered-on full time.  This was pulling power 24x7 from the batteries, which were never completely solar-charging.

By far, the most painful and difficult string of lights to replace are the ones on the crossbeam, as once again the heaviest 9 foot ladder ever created by humans must be collected, setup and moved multiple times.

Of course that's the lighting unit which failed!

I was still having occasional nightmares about catching small 350 - 400 degrees fahrenheit solder balls bare-handed, so I made the decision that if I must make yet again an investment of time to replace the failed crossbeam lighting string, I'm re-architecting the entire design based on lessons-learned.

The first new requirement is: "_No more free handed hot solder gymnastics on ladders and step stools_"

The second new requirement is: "_Need to figure out how to further reduce the voltage drop across tiny telephone extension wires, albeit the four conductor version_"

The third new requirement is: "_Need to be able to swap-out failed LED lighting controllers more easily, without requiring hoisting of Ladder-Zilla_"

The fourth new requirement is: "_Improve the aesthetics of the solution_"

The LED lighting controller boxes are relatively discreet, and when mounted on the north side of the columns, are not visible from the sitting area.

Here is a picture of one, with the battery access door open:

![Factory LED lighting controller enclosure](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-IMG_0215-led-lights-battery-case-open-20220827.jpeg)

It occurred to me that most of the factory enclosure is battery space, and in fact the controller printed circuit board itself is quite small, underneath the left edge of the enclosure.

Here are three controller boards which have been removed from the factory enclosure:

![LED lighting controllers](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-IMG_0207-led-lights-controller-boards-20220827.jpeg)

That's a little metal box used to hold your average-sized gift/credit card, so you can get a sense of how tiny the LED controller printed circuit boards are.

And, there are only four connections: two for power, and two to drive the LEDs.

I found and purchased a nice little IP-67 rated waterproof enclosure, some M2.5M (2.5 mm) standoffs, screws and nuts, and 2.54 mm terminal blocks.

After a day or so at the hobby bench with a piece of pre-drilled and tinned printed circuit board material, I was able to successfully prepare my new "_Unified Multi-Zoned LED Lighting Controller Apparatus_".

![Unified Multi-Zoned LED Lighting Controller Apparatus](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-IMG_0203-original-electronics-in-waterproof-enclosure-20220827.jpeg)

Four terminal blocks are integrated with the three controller boards.  The red terminal block is to receive the 4.5 Volt power supply from the solar cell batteries and buck voltage converter, with the "+" and "-" supplies connected to all three LED controllers.  The remaining three black, green and blue terminal blocks are each connected to a single LED controller's output LED driving connectors.

This enclosure will be placed on the ground on the north side of the west column, replacing the prior power junction/distribution enclosure.

The last step was to once again collect Ladder-Zilla, and completely redo the telephone extension cable wiring.  In this new architecture, it is no longer power to the LED lighting controller boxes distributed around the sitting area.  Instead, the four conductor telephone wire is used only to carry the LED illumination signals.  One discreet length of the four conductor telephone wire was laid across the crossbeam, to feed the LED signals for the east column lighting.  Next the crossbeam lighting string was taken down and flipped, so that the LED signal leads were closest to the west column, drastically reducing the length (and parasitic resistance) of the four conductor telephone wire.  Also, the four conductor telephone wires were no longer carrying 2 x 100 mA for both the east and crossbeam light strings - each telephone wire only carried the 95 mA or so used to illuminate a single string of LED lights.  So even though there was a relatively long length of telephone wire from the west column "_Unified Multi-Zoned LED Lighting Controller Apparatus_" to the east column string of LEDs, that undesired voltage drop due to the telephone wire resistance split in half again, yielding nearly the same peak-to-peak voltage across each of the strings of LEDs.

I was forced to do a third, final round of soldering iron gymnastics for the east column's LED string, mostly because I was too lazy to unwind that lighting string and perform the soldering on the hobby bench.  But the other two LED strings were bench-soldered, and going forward, if an LED string failed, I'll simply take down that failed string and bench-solder the necessary length telephone wiring replacement.

This new architecture fulfilled all the new requirements, and improved upon the implementation for the original requirements.

# Iteration #4: Just can't leave it alone ...

My next and perhaps geekiest indulgence began.

I began to think: "_What if the strings of LED lighting (which are now optimally configured to maximize illumination and simplify maintenance) continue to work perfectly, but more of the controller boards burn up, and there are continued supply chain issues?_"

Obviously, as an Electrical Engineer, I should be able to recreate the LED controller functionality, right?

OK, let's get to work reverse-engineering the LED controller, beginning with trying to understand the LED signals themselves.

Unlike the the front yard solar cell lights, which use a three-wire LED configuration and relatively high voltage (+/- 60 Volts peak-to-peak ... I nearly fried my low-cost digital oscilloscope which has a 40 Volt max input range), the back yard LED lights use a two-wire LED configuration with a +/- 5.8 Volts peak-to-peak range (approximately 2.85 Volts in each alternating direction of LED drive.)

Given that there is only a single 4.5 Volt power supply, the LED signals are created using a "push-pull" or "H-Bridge" circuit.  For the first half of the square wave period, one of the LED driver connectors is positive 2.85 Volts relative to the other connector.  Then when the second half of the square wave period begins, the polarity flips and now what was positive 2.85 Volts is now negative by the same amount.  When the LED signals are in a positive-negative polarity, half of the LEDs illuminate and the other half are off.  Then when the LED signal polarity flips, the illuminated/off LEDs are reversed.  I believe this is achieved by single LEDs of anode/cathode direction alternating with single LEDs of cathode/anode direction LEDs.  The directional single LEDs are then wired in parallel to create the full length of the LED lighting string.  The string of LEDs are hermetically sealed with shrink wrap tubing, and to truly dissect the LED string and confirm this assumption will render that string unusable.  So for now I just accept that this assumption is how the LEDs are actually wired.  Single LEDs in each direction makes sense, since 2.85 Volts is approximately what would be needed to illuminate a single white LED.

Also, at first glance, the square wave appears to be approximately 110 Hz, but on more careful inspection, there is actually a 1.65 KHz sub-harmonic "inner" square wave within the 110 Hz "outer" square wave.  Though I am focusing on "steady-on" of the LEDs, this is how the LED controller creates the other lighting patterns such as chasing and fading, by adjusting (pulse width modulating) the "outer" square wave to be other than a steady 110 Hz.

The inner square wave sub-harmonic does not really add much value for the "steady-on" illumination pattern ... we really only need any square wave which oscillates faster than the human eye can detect alternation, which is about 30 Hz on average.

First we need to start off with a square wave generator, in electrical engineering terms an "astable multivibrator".

One possible circuit is using a TL431 precision voltage reference for the signal gain needed to oscillate:

![TL431-based multivibrator schematic](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-tl431-multivibrator-schematic-20220827.png)

As indicated in the schematic, unfortunately this circuit's square wave is produced with a 2 Volt bias (offset).

The bias/offset can be easily removed with a de-biasing circuit:

![De-Biasing circuit schematic](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-nmos-debias-schematic-20220827.png)

Alternatively, there are many examples of multivibrators which use more common bipolar junction transistors (BJTs), or for even lower quiescent power consumption, metal oxide semiconductor field effect transistors (MOSFETs):

![N-Channel MOSFET-based multivibrator schematic](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-nmos-multivibrator-schematic-20220827.png)

Next, in order to drive the "push-pull" or "H-Bridge" LED driver circuit, we need to create a complementing invert of the square wave.  In fact, we want to gang two of these in series, with the first inverting circuit primarily providing a high input impedance buffer, and then the second inverter being the actual "not" signal of the preceding buffer.

![Inverting circuit schematic](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-nmos-inverter-schematic-20220827.png)

Next, the last circuit in the essential circuits to illuminate the LEDs as "steady-on" is the actual "push-pull" or "H-Bridge" circuit.

This can be created using a combination of BJTs and MOSFETs:

![NMOS PNP Push-Pull H-Bridge schematic](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-nmos-pnp-push-pull-h-bridge-schematic-20220827.png)

Or created using only MOSFETs:

![NMOS PMOS Push-Pull H-Bridge schematic](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-nmos-pmos-push-pull-h-bridge-schematic-20220827.png)

It is also possible to create the push-pull/H-Bridge with BJTs, but no example is provided here.

This is a breadboard of these circuits chained together:

![Breadboard circuit of essential sub-circuits to produce steady-on LED illumination breadboard](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-IMG_0195-multivibrator-debias-inverter-push-pull-h-bridge-20220827.jpeg)

One word of caution: due to the use of discrete, relatively higher power transistors in the push-pull/H-Bridge circuit, the voltage produced is nearly double the voltage produced by the factory LED controller integrated circuit.  In testing momentarily, the higher voltage did not seem to damage the string of LEDs, but that may not be true if operated at this higher voltage over an extended window of time.  

Given that the current through each of the three LED lighting strings is approximately 100 mA, so 300 mA total, we could possibly use one 3 Ohm resistor between each of the push-pull/H-Bridge driver contacts and the actual string of LEDs, for a total of 6 Ohms total inline with the LED strings.  With 300 mA flowing thru the resistors, this would reduce the 4.5 Volt peaks by 1.8 Volts, resulting in 2.7 Volt peaks, or 5.4 Volts peak-to-peak.  Some experimentation with resistor values is probably required.  This would be slightly wasteful use of limited solar cell battery power capacity, though any other option will probably waste even more power.

Next, it would be nice if a darkness detector could be used to turn on the LED lights.

Here is one proven circuit which uses a 555 Schmitt trigger to that when the phototransistor is just barely switching light vs. dark detection, there is no "bounce" or "banging" of the output signal when right on that threshold between light vs. dark.

![Phototransistor-based darkness detector using a 555 Schmitt trigger for debounce schematic](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-phototransistor-555-schmitt-trigger-schematic-20220827.png)

Here is a breadboard wiring of this circuit:

![Phototransistor-based darkness detector using a 555 Schmitt trigger for debounce breadboard](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-IMG_0197-phototransistor-555-schmitt-trigger-20220827.jpeg)

# Iteration #5: Does anybody really know what time it is?

If the solar cell's battery was a much larger capacity, I may be less concerned about limiting the time that the LED lighting strings are illuminated, to say the evening hours we're actually awake to enjoy them.  But the solar cell's capacity is quite limited, so we really only want the lighting strings to run 4 or 5 or 6 hours after they turned on, be it from darkness detection, or as is the factory controller a simple 24-hour 6-hour "ON" timer which begins when you turn the lighting on.

Having designed and built many "flip flop" binary ripple counter circuits over the years, I figured I would just get ahead of the curve and order a dozen of each 4060 and 4020 counter integrated circuits (ICs), so they'll be here when ready to breadboard and then actually for-real build all this.

OK, now I feel really, really old.

The 4000 series of ICs were table-stakes chips to build systems.  It turns out in the year 2022, they are somewhat obtainable in surface mount packaging, but traditional dual in-line packages (DIPs) are unavailable, take weeks or months to receive after ordering, or are ridiculously expensive.

If I rummage around in my old electronics boxes, I probably can find a handful of each of these.

But that won't work.

"_How am I supposed to create my dynasty as the overarching leader in producing environmentally-friendly LED lighting solutions, if I cannot obtain the necessary raw materials?_"

I suppose I could subcontract the actual assembly of the devices to a 3rd-party, but that will just cut into my assured future mega-profits.

# Iteration #6: To the moon and back

I have been using Raspberry PI's for small, odd projects for a while now, but to-date I have never used the "Pico" model, which is not a single board computer (SBC) running Linux, but rather a small, sub-ten-dollar system-on-a-chip (SOC) based on Raspberry PI's own ARM CPU, the RP4020.  It has just enough periphery components to plug into a breadboard or printed circuit board, then add any additional components one needs for her/his specific project.

There is also a Pico clone from the vendor Seeed Studio (no, that's not misspelled ... there really are three "e" letters in the vendor's name).  Although the official Raspberry PI Pico is very small, about a third of a post-it note, the Seeed Studio XIAO RP2040 is 1/3rd the size of the Pico.  The Seeed device costs double or more than the Pico, but that's still less than $15.

Looking at the specifications, the RP2040 SOC contains thousands (tens of thousands?) of times the horsepower of the IBM computer that propelled US astronauts to the moon and back.

I should be able to use this to make back yard lighting illuminate, with all the requirements met.

I'm currently using a late 2018 Intel i9 16 GB RAM Macbook Pro, to develop, compile and debug the RP2040 microcode/firmware which runs on either the Pico or XIAO.  I needed to install a small number of ARM development toolchains, but the steps are well-documented by Raspberry PI, and the resultant binary can run on either device (just be sure to only target input/output (IO) available on the much smaller and pin-reduced XIAO device.)

Here is a picture of my XIAO breadboarded.  The black wire when pulled down to ground represents my darkness detector detecting darkness.  The green wire when pulled down to ground represents a momentary push button which after three seconds toggles the power-on state from off to on, or vice-versa.  The orange is the output pin which indicates whether the LEDs should be illuminated or not.

![Seeed Studio XIAO RP2040 breadboard](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-IMG_0200-seeed-studio-xiao-rp2040-20220827.jpeg)

The source code for as much of the basic functionality as I currently have running is available in the "source" subdirectory.  It currently toggles the LED illumination on for one second then off for two seconds.  The code started with a combination of the serial USB sample SDK code, plus the blink sample SDK code, plus my own logic additions.

# Time to go learn things ... and continue to search for my elusive whale

And this is where this odyssey, in fact obsession, currently stands.

Next steps are to better-understand the Pico/XIAO capabilities, as initial research proposes that much of what was implemented in analog hardware might be reproducible directly within the digital SOC.

My intent is to continue to add to this work, providing updates as progress is made.

# All Hallows' Eve 2022 Updates

Veni Vidi Vici ...

The Seeed Studio Raspberry PI implementation is working as expected, with the latest source included in the "source" directory.  As provided, once the light detector indicates darkness, the LEDs will illuminate on for one second then off for two seconds.  The source should be adjusted for the number of minutes/hours on then off.

I have a backlog item to add a "timer delay after darkness detected" to the source.  This would allow, for example, darkness to be detected late afternoon (such as mid-winter) but the LEDs not turn on until a few hours later that evening.

Here are some pictures of the wired-up printed circuit board, and the schematic.  It is important to remember that the Seeed Studio can accept a 5 Volt power supply (4.5 Volts also tested successfully), but operates internally at 3.3 Volts.  This means all signals into the Seeed, such as the momentary-contact switch and darkness sensor, must have a following MOSFET/BJT in an open source/collector configuration using the Seeed's internal pull-up resistors.

N.B.: The push-pull/H-Bridge MOSFETs do not need to be nearly as high-powered as presented here.  These devices were selected primarily because they are actually easier to find and less expensive than TO-92 packaged transistors, particularly for P-Channel, and consume the same printed circuit board real estate when mounted vertically.

Here is the pinout of the Seeed Studio board - the C source code uses the light gray micropython pin numbers.

![Seeed Studio XIAO RP2040 pinout](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-seeed-studio-pinout-20221030.png)

Here are pictures of the printed circuit board with Seeed Studio board plus discrete components.

![Seeed Studio XIAO RP2040 pcb top](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-pcb-top-20221030.jpeg)

![Seeed Studio XIAO RP2040 pcb bottom](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-pcb-bottom-20221030.jpeg)

Here is the schematic.

![Schematic - all](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-schematic-all-20221030.png)

![Schematic - left half](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-schematic-half-left-20221030.png)

![Schematic - right half](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-schematic-half-right-20221030.png)

# November 2022 Waning Gibbous Updates

Indeed, as shared above in the "All Hallows' Eve 2022 Updates", I have working Raspberry PI Pico software which will manage the LEDs, however I am still currently using the vendor-provided LED controllers.

Frequently, we would have a very sunny day, suggesting the solar cells would fully charge the Li-Ion batteries to full capacity, which should allow the LEDs to illuminate through and beyond the full six (6) hour timed session.

Sadly, more frequently than desired, less than four (4) hours after the LEDs illuminated, they would go dark.  On multiple evenings, I would immediately mount an evening investigation, and sure enough, the buck voltage converter's "power available" LED was also dark, indicating it was receiving no power from the batteries.

Being a student and strong supporter of the "Scientific Method" to understanding, I began an analysis of what might be transpiring under the cover of darkness.

Were rabid rabbits knawing through the wires?

Were kids down the street tapping into my top-secretly-modified solar battery voltage source to power their $5,000 gaming-laptops to play "Overwatch"?

Did foreign nation-states just execute an "Electro-Magnetic Pulse" ("EMP") surgically and strategically targeting my solar-based, environmentally-friendy Minimum Viable Product ("MVP"), as they were secretly trying to corner the market in this multi-trillion dollar consumer space?

Or did something just "burn up"?

I am blessed to have many friends, and my friends are gifted in many ways.  

Folks like me have thoughtful sayings, two (2) of which for me are:

1.  If you think you are the smartest person in the room, then that just proves you are not.

2.  If you actually are the smartest person in the room, time to find a new room where you are not.

In the end, it was (my) human error of not fact-checking what was really going on.

What was really going on?

I was NOT getting the power efficiencies which I had previously experienced when building my own power/voltage converters!

Below are some pictures of these details.

![Buck converter Vdd to LED Vpp correlation](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-IMG_0229-buck-converter-vdd-to-led-vpp-correlation-20221110.JPG)

![Buck converter output voltage reminder](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-IMG_0226-buck-converter-set-output-voltage-20221110.JPG)

![Buck converter power conversion efficiency](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-IMG_0232-buck-converter-power-efficiency-testing-20221110.JPG)

![Buck converters power conversion efficiency comparison](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-IMG_0236-buck-converter-efficiency-comparison-20221117.JPG)

I cannot currently explain why the buck-converter architecture worked through most of last winter; it's possible that colder/freezing weather is a variable or influencer here, and perhaps that architecture was always "just barely on the edge of working" ... honestly not certain at this time.

Back to the drawing board ... yet again.

# "Simplicity is often best" Updates

To improve the "power efficiency" story, I wanted to find a way to power the LEDs without a buck (or boost) voltage/power converter.

The vendor-specified voltage is 3 "AA" 1.5 volt batteries in series, or 4.5 volts.

The solar cell Li-Ion battery is 4.1 volts.

So the $64,000 question becomes: how low can these factory LED controllers go?

After some higly-scientific testing, it turns out that the drop-out voltage of the factory LED controller, where the controller ceases to operate, is around 2.5 Volts:

![LED Controller drop-out voltage](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-IMG_0235-drop-out-voltage-20221117.JPG)

But the three (3) 4.1 volt solar batteries, if used in parallel, will require forward-bias diodes in each path to prevent battery voltage differences cross-charging each other ... this can have a spectacular outcome, not in a good way.

But under the three (3) x 50 milliamp load of the three (3) LED strings, would certainly result in the anticipated 0.7 volt drop across the forward-bias diodes from the 4.1 volt (at best) solar battery, yielding 3.4 volts.

Minus the 0.25 volts drop across the length of 22 AWG wire going from front yard solar cell batteries to back yard LED controllers.  So now (at best) we're looking at 3.1 volts at the beginning of the evening illumination, with an LED controller cutout around 2.5 volts.

That leaves 0.5 volts of difference between a nice winter's eve illumation and cold hard winter darkness.

What to do Pooh?  Yes, I know ... "_think think think ..._"

# "Schottky in the dark" Updates

The mind is an interesting thing.  One may rack her/his brain on a problem for hours, with the outcome of "I dunno ...".  Then, in the middle of the night you snap awake with the solution.  Now the trick is to either remember the answer in the morning.  Or if like me, keep a small notepad and pen on the nightstand so I can quickly scribble down the answer ... now in the morning, I only need to remember that the midnight epiphany occurred.

My morning-discovered scribble said "Schottky".  Of course, unlike the normal silicon signal or rectifier diode, which is a dual-semiconductor positive (P) to negative (n) doped junction, a Schottky diode is semiconductor to metal.  Unlike a normal silicon diode with a forward-bias voltage drop of approximately 0.7 volts, a Schottky diode only produces approximately a 0.2 volt forward-bias voltage drop.

Updating the math above, the 4.1 volt solar batteries should then provide 3.9 volts after the Schottky diodes, minus the 2.5 volts due to the 22 AWS wire from front to back yard, yielding approximately 3.6 volts a the LED controllers.  This would provide over 1 volt of window between first-illuminated voltage to the LED controllers, and the measured 2.5 volt drop-out voltage, which is a much more acceptable solution.

Schematic for Schottky diode protected parallel solar cells/batteries:

![Schottky diode parallel power](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-schottky-diode-power-20221120.png)

The one (1) ohm resistors provide a test point for amount of current each solar cell/battery is providing.

Schottky diode protected parallel solar cells/batteries circuit:

![Schottky diode parallel power circuit](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-IMG_0238-schottky-diode-power-circuit-20221124.JPG)

Schottky diode protected parallel solar cells/batteries voltage testing after a single overnight cycle:

![Schottky diode parallel voltage testing](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-IMG_0240-schottky-diode-power-voltage-20221124.JPG)

# "If you think you've mastered the _Angels in the Details_ of a project ... guess again" Updates

The breadboarding experimentation matched the mathematical calculations.

The series solar batteries plus voltage converter architecture was replaced with the parallel solar batteries plus Schottky diode architecture.

With the soldering iron cooling down, I took the new power box out to the solar cell batteries, and prepared to plug everything together.

It was a beautiful, very sunny, and relatively warm early-winter day.  Very sunny.

I don't know what made me double-check the solar cell battery voltage, but luckily I did:  __6.8 volts!__

Unclear what the over-voltage threshold of the LED controllers is, but given they were designed to operate at 4.5 volts (max) via the three "AA" batteries, I would imagine that nearly 7 volts would cause damage or destruction.

Up until now the solar cell battery voltage was never a consideration (though I should have thought to check after all this time!) because I either had a boost or buck voltage converter, and either had a large input voltage range and 7 volts would not be an issue.

But now with the Schottky diode design, the output voltage would always be 0.2 volts below the solar cell voltage.

Sigh ... yet the next thing to figure out.

OK, time to get to work.

At first I thought, this is straight-forward: I'll create a simple voltage comparator circuit and if the voltage exceeds a TBD threshold  (say, 5.0 volts), simply disconnect the solar battery power from the LED controller via a transistor or relay.

But then I realized, that won't work.  Once power is removed from the LED controller, they lose their memory for on/off timer, and which illumination pattern was set (steady-on, flashing, etc.)  That means every night after a very sunny day, I would need to trudge outside and restart the LED controllers ... not operationally optimal at all.

After a couple more midnight awakenings, I figured out one possible solution.

Going back to the basic facts of how the solar cell charging integrated circuit (IC) works, plus how the overall architecture works through the course of a 24 hour cycle, the solution is a little more complicated than desired, but it does appear to work.

The both the solar cells (charging) and LED controllers (discharging) are by-design connected together and also connected to the charging IC's input voltage.  The charging IC then manages the current into the Li-Ion battery (charging) and out of the battery (discharging).  That's how the IC provides over-voltage/over-current/over-heating of the Li-Ion battery.  In a typical solution not using solar cells for charging and their associated very wide range of output voltage, a regulated power supply would be used and it would be set to be just a little higher voltage than the 4.1 volts of the Li-Ion battery, and that slightly higher voltage would be compatible with whatever is the circuit being battery-operated.

In my current situation, the solar cells will produce the 6.8 volts under very sunny conditions, but decay down to zero volts produced by the solar cells in darkness (that's where the batteries take over and provide evening illumination.)  Throughout this journey, I have been very sensitive to the amount of power consumption of the various architectures tested, to maximize how long the LED controllers and thier LEDs can run on a single charge.  But here, on very sunny days, the solar cells are actually producing too much power ... so it's ok to be a little wasteful, so long as not so wasteful that the solution begins drawing current out of the batteries.

A 5 volt LM340T5 (7805) linear series voltage regulator is considered "low power" though everything is relative, and I would not consider it "ultra low power" which is what I have been designing to.

And a 5 volt coil double-pole double-throw (DPDT) normally-open + normally-closed (NO-NC) contacts relay is definitely not considered "ultra low power".

However these two components together are still easily powered by the three (3) solar cells connected in parallel; each solar cell is actually capable of producing quite a bit of current.

In my new "Over-voltage protection circuit", there will be two output voltages produced leading to the onboard Schottky diodes:
- The direct solar cell and battery output which may rise to nearly 7 volts but operates in darkness off the batteries at 4.1 volts  
- The 5 volt regulated output from the 7805  

I'll then use a voltage comparator circuit to control the relay.  When the solar cell and battery voltage is below 5 volts, this direct output passes through the relay's normally-closed terminals to the LED controllers ... this is safe/fine because the LED controllers, though designed to run at 4.5 volts, most-likely can handle 5.0 volts without damage.  However when the solar cell and battery voltage is above 5 volts, the 5 volt regulated 7805 output will be fed to the LED controllers through the normally-open terminals.

Because the 7805 requires approximately 1.5 volts of "overhead input voltage" beyond it's output voltage (thus 6.5 volts at the input of the 7805 regulator), at solar cell and battery voltage of 5 volts, the 7805's output is only around 3.5 volts.  But 3.5 volts is well-above the 2.5 volt drop-out voltage of the LED controllers, so as the source voltage flips between direct solar cell and battery output when below 5 volts, and the 7805's 3.5 volts when solar cell output exceeds 5 volts, the LED controllers should always have power and retain their timer and settings memory.

The TL431 voltage reference is a natural fit in the design.  It's highly accurate, extremely mature and versitile ... and importantly very inexpensive.  Operated in the open-loop mode, what the TL431 does is reduce it's output (cathode) voltage and sink more current when the external Vref reference voltage pin exceeds it's internal 2.5 volt reference voltage.  Essentially the TL431 tries to be an open switch when the external Vref reference voltage is below 2.5 volts and a closed switch when the external Vref reference voltage is above 2.5 volts.  But being a semiconductor circuit, it has voltage drops and parasitic resistances, so in actuality it's not a perfect switch.

I used two (2) 10K resistors to equally-divide the solar cell and battery voltage at the TL341's external Vref reference voltage pin, resulting in 5 volts of solar cell and battery voltage being presented as 2.5 volts at the external Vref reference voltage pin.

Finally, the TL431 does require approximately 1 milliamp of output (cathode) current to operate, so using a 2.2K resistor on the cathode will produce a couple milliamps of quiescent current.

TL431 5 Volt trigger testing - the TL431 cathode sharply goes low when the 2.5 volt internal reference voltage is exceeded:

![TL431 Circuit](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-tl431-5-volt-trigger-IMG_0241-20221124.JPG)

![TL431 Circuit - 5.00 volts off 4.94 volts](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-tl431-5-volt-trigger-IMG_0242-5.00V-off-4.94V-20221124.JPG)

![TL431 Circuit - 5.03 volts partially-on 2.21 volts](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-tl431-5-volt-trigger-IMG_0243-5.03V-partially-on-2.21V-20221124.JPG)

![TL431 Circuit - 5.08 volts on 1.92 volts](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-tl431-5-volt-trigger-IMG_0244-5.08V-on-1.92V-20221124.JPG)

![TL431 Circuit - 5.54 volts on 1.85 volts](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-tl431-5-volt-trigger-IMG_0245-5.54V-on-1.85V-20221124.JPG)

We need to convert the TL431's "closed switch to ground at high external reference voltage" signal into a control signal to close the 5 volt coil DPDT relay's normally-open (NO) terminal, applying the output of the 7805 regulator's voltage to the relay's common terminal, sending that voltage to the LED controllers, instead of the now-too-high normally-closed (NC) terminal's direct solar battery voltage.  This is easily achieved by using a general purpose PNP bipolar junction transistor (BJT).  I selected the common 2N2907 PNP transistor for this purpose - also mature, versatile and inexpensive.  Simply use a 10K resistor between the TL431's cathode and the 2N2907's base lead to limit the base current.

N.B.: There is significant conflicting diagrams and information on the exact pinout of the 2N2907 transistor in the TO-92 package.  There are actually quite a few datasheets and diagrams depicting collector-base-emitter (CBE), though my recollection was always emitter-base-collector (EBC).  Under very low current conditions, say powering an LED through a 1K resistor, breadboarding the 2N2907 CBE or EBC will sort-of result in working either way.  To truly determine which lead is the emitter and which is the collector, you need to measure the voltage across leads 1 and 3 with a saturated base current (forcing the transistor to be "full-on".)  If the voltage is more than 100 millivolts then you have the transistor leads 1 and 3 backwards.  Using this approach, I confirmed the correct pinouts for my batch of 2N2907 transistors is EBC.

And of course, remember to include the reverse-biased rectifier diode across the relay coil, so the inductive kick reverse current produced when the PNP transistor cuts voltage to the coil does not blow the transistor.

Finally, it would be nice to have an onboard LED illuminate when we are at too-high-voltage situation and the power supplied is the 7805 regulator's output.  Easily done by placing an LED and 10K resistor in parallel with the relay coil.

Now let's construct a complete over-voltage protection circuit:

![Over-voltage protection circuit - schematic](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-over-voltage-protection-schematic-20221204.png)

![Over-voltage protection circuit - full breadboard](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-over-voltage-protection-IMG_0246-full-breadboard-20221127.JPG)

![Over-voltage protection circuit - focused breadboard](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-over-voltage-protection-IMG_0247-focused-breadboard-20221127.JPG)

![Over-voltage protection circuit - 5.02 volts not yet protected](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-over-voltage-protection-IMG_0248-5.02V-not-yet-protected-20221127.JPG)

![Over-voltage protection circuit - 5.03 volts yes protected](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-over-voltage-protection-IMG_0252-5.03V-yes-protected-20221127.JPG)

![Over-voltage protection circuit - circuit board view 1](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-over-voltage-protection-IMG_0254-circuit-01-20221127.JPG)

![Over-voltage protection circuit - circuit board view 2](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-over-voltage-protection-IMG_0255-circuit-02-20221127.JPG)

# "Spring 2024 Has Arrived!" Updates

It's been a few months since my last update.

Overall the performance of the back yard lighting system has worked flawlessly.

One thing discovered, as always, somewhat by accident: under just the right (or wrong) sunlight levels, the TL431 would "partially" turn on the 2N2907 PNP transistor, resulting in a small but measurable steady-state current to continuously flow through the transistor and the relay coil, until the sunlight intensity either increased (turning the transistor and relay full-on) or decreased (turning the transistor and relay full-off).  I only noticed this due to coincidentally checking the system and hearing the relay coil "chattering" open and closed.  This will most-likely eventually lead to failure of the PNP transistor, relay or both.

In electrical engineering terms, the circuit needed _hysteresis_ added to it.

Meaning, once the threshold to transition state from either off to on, or on to off, it will take a larger corresponding swing of input to reverse the state.

As shown in the schematic next, by adding a large resistor from the output (collector) of the PNP transistor feeding voltage back to the TL431 reference input, we achieve hysteresis.

When the Vps voltage crosses the threshold for the measured TL431 reference voltage to turn "on" the PNP transistor (by the TL431's cathode becoming a logical current "sink" or "short" to ground), the feedback resistor attached to the PNP collector "lifts" the measured TL431 input reference voltage even higher.  This means that, for the TL431 to reverse state back to "off", the actual value of Vps needs to fall even lower below the level which would normally turn the TL431 "off" absent the hysteresis resistor.

Correspondingly, once the TL431 turns "off" the PNP transistor (by the TL431's cathode becoming a logical current "open circuit"), now there is a "pull down" resistive effect composed of the hysteresis resistor in series with the combination of the LED and resistor parallel to the relay coil, in parallel with the relay coil itself.  The relay coil resistance (hundreds of Ohms) will logically dominate to appear to be a logical zero ohm "short" to ground, when compared to the other resistor values in play here.  This means that, for the TL431 to reverse state back to "on", the actual value of Vps needs to rise even higher above the level above which would normally turn the TL431 "on" absent the hysteresis resistor.

The hysteresis resistor values are very much determined by trial and error, and each circuit with it's many tolerances will set the resistance need to achieve the desired Vps hysteresis.

For example, a 1M Ohm hysteresis resistor was working well for months, when for unknown reasons, one day the installed TL431 failed.  After replacing the failed TL431 with a working device, the hysteresis resistor of 1M Ohm no longer provided much hysteresis, as during testing, there was a small sunlight intensity window with relay coil "chatter".  Replacing the hysteresis resistor with a 100K Ohm value resulted in the desired hysteresis.

It is therefore best to not directly solder the hysteresis resistor into the circuit, but rather install socket pins, so the hysteresis resistor may be easily changed with different values, should components fail and need to be replaced again in the future, or other conditions such as temperature change the results.

The prior schematic and implementation also erroneously omitted the reverse voltage protection diode in parallel with the PNP transistor, so that has been corrected.

Here is the most current over-voltage protection circuit:

![Updated over-voltage protection circuit - with hysteresis feedback](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-over-voltage-protection-schematic-batterydiodeovervoltageprotect4-20240320_174500.png)

I recently had to replace a couple of the un-modified solar cell/battery enclosures in the front yard.  Though I seasonally display then take-in the multi-color lights around the year-end holidays, the white "peace" lights on the front shrubs stay lit year round.  Many families in the neighborhood do similarly, I believe helping all of us remember what's important to us ... for me, how precious life is and how thankful i am for just being.

During Covid, I had stocked-up with a few spares, but now that supply was down to just one or two.

Upon attempting to refill prior purchases at Amazon, I received the dreaded "Currently Unavailable" message.

Upon widening the search, some similar solar lights with clearly the same solar cell/battery enclosure were available, but their cost was double or triple my original lights.

Clearly market forces have shifted!

Now, it was apparent that there was a "new kid on the block" ... instead of the previously-popular "4.2V Li-Ion" enclosure, the new (and far less expensive and far more common) kid is now a "1.2V Ni-MH" enclosure.

At first I felt defeated.

But then I realized, that with 1.2V batteries, I could now wire 4 of them in series to achieve an average 4.8V supply to the back yard LEDs.  Remember, it is much easier and more efficient to wire power supplies in series instead of parallel, since parallel requires the (Schottky) diodes.  Although the power loss/waste is minimized due to Schottky diodes, it's still a loss in a battery powered system with limited recharging capabilities.

The new 1.2V Ni-MH devices also had other advantages:  
- A 1800 mAH battery (vs the previous 1200 mAH battery ... a 50% increase of battery storage capacity)
- The solar cell/battery enclosures were approximately half the physical size and weight of the prior enclosures
- They were actually slightly less expensive than the prior units

The circuitry and PCB of the new 1.2V Ni-MH solar battery was far simpler than the 4.2V Li-Ion solar battery.  I could not find an explicit solar-to-battery charging regulator, nor was there an apparent way to "disconnect" the LED string driving terminals and circuitry from the solar cell and battery.

However after a little thought, because the new circuitry was so much simpler (far fewer exteral active and passive components outside the integrated circuit controller vs the 4.2V Li-Ion solar battery), there is most-likely no "waste" of energy as whatever is converting the 1.2 (battery) and 1.4 (solar cell) volts to the 5 volts needed by the new IC, that is what is required to drive the LED string.  The PCB contains a "5.1V" label along with an inductor marked "330" which I assume to mean 330 mH, along with what appears to be a surface-mount IC, most-likely a transistor (the markings are just too faint and small to discern) a couple diodes and a capacitor, suggesting some form of rudimentary boost voltage converter.  The surface mount IC may be an explicit solar-to-battery charging regulator, but the connection pads on the PCB appear to be a different configuration from the "Shikues Foshan Blue Rocket Electric BRCL3130ME" 4.2V Li-Ion charging regulator, which makes sense as the two devices have completely different battery technologies and voltage/power characteristics.  I may try to search some more, and find a higher power lamp and magnifying glass, to see if i can identify the IC.

N.B.: Though my curiosity to identify the IC will be pursued, in some ways the outcome is moot.  As will be shared shortly, I actually will need the LED string output drivers, as a Power On/Off button indicator.  So any attempt to "strip" the PCB of unneeded components in the pursuit of improved power efficiency, is no longer an optional.  All the components and all the functionality is required.  But more on that in a bit.

Rather than "jump all-in" and purchase four of the new 1.2V Ni-MH devices, I decided to just order a pair of two, and looked forward to performing the electronic autopsy to begin to understand how the devices worked upon arrival.

The first procedure was to open up one of the devices, and do some basic voltage readings under various conditions in bright sunlight.

Voltage across the solar cell terminals with no battery installed:

![1.2V Solar Battery Lights - Solar cell terminals - No battery installed](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--solar-cell-terminals-voltage-no-battery-IMG_0133-20240322.JPG)

Voltage across the battery terminals with no battery installed:

![1.2V Solar Battery Lights - Battery terminals - No battery installed](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--battery-terminals-voltage-no-battery-IMG_0134-20240322.JPG)

Voltage across the battery terminals with yes battery installed:

![1.2V Solar Battery Lights - Battery terminals - Yes battery installed](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--battery-terminals-voltage-yes-battery-IMG_0135-20240322.JPG)

Ok, so this means under bright sunlight, the battery voltage actually slightly exceeds the specified 1.2V and is actually almost 1.5V.

This suggests that an over-voltage protection circuit will probably still be required, if four of the units are wired in series, as the total voltage in series could approach nealy 6.0 volts.

It should be noted that some quick math suggests that the back yard lights should actually work fine for 6 hours using only three units wired in series, and this would avoid the need for the over-voltage protection circuit, but that will be a confirmation test for a future date.

Opening the new enclosure, removing the battery then cutting the LED string leads, this is what we have:

![1.2V Solar Battery Lights - LED string cut off](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-01-led-string-cut-off-IMG_0137-20240322.JPG)

With the LED string leads tails removed:

![1.2V Solar Battery Lights - LED leads removed](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-02-led-string-leads-removed-IMG_0138-20240322.JPG)

We will want to attach battery "+" and "-" leads to supply the back yard lighting.

As we see in the picture below, there is already a spare "B-" solder pad which we can use.

In order to attach the "B+" wire lead, we need to scrape-off some of the solder mask, exposing the copper beneath:

![1.2V Solar Battery Lights - Scrape off battery positive solder mask](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-03-battery-positive-solder-mask-scraped-off-IMG_0140-20240322.JPG)

Once the "B+" copper is exposed, we "pre-tin" by adding a generous solder ball to the copper, to make connecting the positive wire quick and easy:

![1.2V Solar Battery Lights - Add solder ball to battery positive](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-04-battery-positive-solder-ball-added-IMG_0141-20240322.JPG)

We "pre-tin" the battery wires and easily attach them to the "B+" and "B-" solder pads.

N.B.: we will follow the same standard as the prior solar battery enclosure, where the wire with the white ink dots is the positive lead.

![1.2V Solar Battery Lights - Battery positive and negative wire attached](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-05-battery-positive-negative-wire-attached-IMG_0142-20240322.JPG)

This shows where the battery wires will exit the enclosure - out the same path which would have been the string of LED lights:

![1.2V Solar Battery Lights - Battery wire out enclosure](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-06-battery-wire-out-enclosure-IMG_0143-20240322.JPG)

We can include a knot in the battery wire as a strain relief, so during mounting and assembly the wire does not pull from the solder pads if the wire is temporarily under strain.

N.B.: After trial and error, the enclosure closes better by tying the knot in the reverse direction from the picture below ... it just fits better.  Instead of the battery wire extending over itself in a clockwise direction (from a reference point of outside the enclosure looking in), it fits better by extending under itself in a counter-clockwise direction.  This seems to place more of the mass of the wire knot deeper into the bottom of the enclosure case where there is room ... the top of the enclosure case has an extending flange which will press against the top of the wire, and the wire needs to be quite flush to the top of the strain relief cavity.  Future pictures will depict the preferred battery wire knot direction.

![1.2V Solar Battery Lights - Battery wire knot out enclosure](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-07-battery-wire-knot-out-enclosure-IMG_0144-20240322.JPG)

Now that all the soldering should be completed, before closing the solar battery enclosure, let's perform some checkout of the electrical signals.

Here is the oscilloscope output with no LED string connected to the "L1" and "L2" solder pads, with output waveform providing a little over 8 volts peak-to-peak signal.

N.B.: I cycled through the flashing patterns to select the "full-on" pattern vs. one of the fade/flash/flicker patterns.

![1.2V Solar Battery Lights - Oscilloscope no LEDs 8 Vpkpk](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-08-oscilloscope-leds-disconnected-8-volts-peak-to-peak-IMG_0145-20240323.JPG)

Here is the oscilloscope output with yes the LED string connected to the "L1" and "L2" solder pads, with output waveform providing a little over 5 volts peak-to-peak signal.

![1.2V Solar Battery Lights - Oscilloscope yes LEDs 5 Vpkpk](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-09-oscilloscope-leds-connected-5-volts-peak-to-peak-IMG_0147-20240322.JPG)


And now we re-enter the realm of "angels in the details" ...

In the new solar battery lights instructions, it says that the Power On/Off button must be "on" in order for the solar cells to actually charge the battery.

The instruction say to completely cover the solar cell, so no light can hit it, and then press the Power On/Off button until the LED string turns on.  This confirms now that the solar cell will charge the battery.

Now we have a conundrum: we've removed the LED string, as it's not needed in this "solar charging battery power supply" configuration, so now we have no way to ensure the Power On/Off button is "on".

We can initially turn the button "on" but how do we know in the course of installation, we did not accidentally hit the Power On/Off button and accidentally turn it "off"?

And we'll have at least three, most-likely four, solar battery units in series, so now we have four times the chances of accidental reset of the button to "off".

The answer is semi-obvious: we need a way to add a power "on" indicator to the architecture, attached to the "L1" and "L2" solder pads (plus a series current limiting resistor ... for 5 - 8 volts, a 1K Ohm resistor should suffice.)

The power "on" indicator (LED) would penetrate the enclosure and give us the same visual confirm

An important detail, looking at the oscilloscope waveforms above, is that it is a "push-pull" signal, resulting in a square wave of equal voltage of 5 to 8 volts above and below common-ground.

Because of this, we cannot use just a single LED (and current-limiting resistor) ... it will work/survive the positive voltage but when the square wave reverses, the negative voltage will damage/destroy the LED ... perhaps not instantly, but most-likely over time.

We could attach an inverted bypass diode parallel to the LED, anodes to cathodes, and that would protect the LED from the reverse voltage polarity.  

That would also result in 50% power loss/waste when positive current is flowing through the bypass diode ... and 50% power loss/waste is always an anti-pattern in battery powered solutions.

Instead of an inverted bypass parallel diode, we could instead use a second LED, but then do we just expose one of the two LEDs by penetrating only one of them through the enclosure, which is essentially back to 50% loss/waste since the second LED will not be exposed but rather remain internal to the enclosure.  Or do we drill two holes in the enclosure, and double the likelihood of mosture and water entering the enclosure?

Though not the easiest to find, there are specialized 2-pin LEDs which, as a single encapsulated unit, are configured as inverted parallel LEDs with anodes to cathodes.  If power is applied in one direction we get red illumination, and with power applied in the reverse direction we get green illumination.  Specialized electronics dealers offer a range of color options, but on Amazon I was (thankfully) able to find one device in the red-green color combination:

![1.2V Solar Battery Lights - 2-Pin bidirectional red green LED 1](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--2-pin-polar-bidirectional-red-green-led-amazon-01-20240323.png)

![1.2V Solar Battery Lights - 2-Pin bidirectional red green LED 2](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--2-pin-polar-bidirectional-red-green-led-amazon-02-20240323.png)

To try to address the concern of mosture and water entering the enclosure, I also purchased small o-rings, to add around the LED once penetrating the enclosure.  As the LEDs are 3.0 mm in diameter, I purchased 1.5 mm inside diameter o-rings, so there would be some stretch/tension on the LED to keep the o-ring in place.

N.B.: Unfortunately, it turned out that there was very little of the body of the LED extending through the enclosure hole, not enough to properly "seat" the o-ring around the LED and not fall off.  For now we will rely on a close-tolerance fit of the enclosure 3 mm hole and the 3 mm LED.  When the enclosure is mounted on it's bracket and solar cell directed towards the sun, the hole is on the underside of the enclosure, limiting the likelihood of water/rain flowing directly into the enclosure through the hole.  But if this becomes a problem, a small dab of clear silicon caulk may be placed around the LED to close any gap between the hole and LED, and seal the enclosure.

![1.2V Solar Battery Lights - O-Ring for bidirectional red green LED - Did not actually work](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--2.5-mm-inside-diameter-o-ring-for-3-mm-led-amazon-01-20240323.png)

As mentioned above, if we use only three solar battery units in series, even with a highest-voltage case of 1.5 volts, that would still only be 4.5 volts total, which equals the 4.5 volts for the back yard lighting using three "AA" 1.5 volt disposable batteries.  So in this case there is no need for an over-voltage protection circuit.

However, using three solar battery units in series at 1.2 volts nominal will be 3.6 volts, which is rather low.  And as the batteries deplete during the 6-hour LED "on" timer cycle, the total voltage will further drop, potentially to below the drop-out voltage of the back yard lighting controllers, resulting in having to restart and reset the lighting each evening.

Therefore we will accept the fact that we need four solar battery units in series and incorporate a refactor of the over-voltage protection circuit as exists today for the 4.2 volt Li-Ion solar battery units.

To refactor the existing over-voltage protection circuit, we will remove all active and passive components installed via socket pins.

We will then de-solder the terminal blocks used to connect the three 4.2 volt Li-Ion solar batteries.

Going forward, input power will be via separate "sub-assembly boards" sized to not exceed the open space on the main board, and consist of either:
- The original three terminal blocks plus Schottky diodes and (optionally but selected) 1 Ohm resistors, wired in parallel
- New four terminal blocks wired in series - due to real estate limitations using an available PCB, fitting a 1 Ohm resistor to the board was problematic, and is less valuable in a series configuration vs. a parallel configuration (where there is value in understanding how much power each of the parallel power supplies is contributing)

Finally we will add a terminal block to receive the input power from the output of the sub-assembly board.

N.B.: Though originally an oversight, there is no significant need for capacitor(s) across the new terminal block to receive the input power from the output of the sub-assembly board.  Battery power sources tend to be very "quiet" from an electrical "noise" perspective, and the wire leads from sub-assembly board to terminal block are quite short and 22 AWG (silicon) stranded wire, which is significantly over-sized for the amount of current which will be carried over these wires.

Here is the over-voltage protection circuit refactored, with all socketed active and passive components removed:

![Over-voltage protection circuit - Repurposed 1](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-10-over-voltage-protection-circuit-repurposed-01-IMG_0148-20240325.JPG)

Here is the over-voltage protection circuit refactored, with all socketed active and passive components reinstalled:

![Over-voltage protection circuit - Repurposed 2](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-11-over-voltage-protection-circuit-repurposed-02-IMG_0151-20240325.JPG)

Here is the over-voltage protection circuit refactored, with all socketed active and passive components reinstalled, plus the four-in-series terminal blocks sub-assembly board for the new 1.2 volt Ni-MH solar batteries, prior to adding the insulating electrical tape to the bottom of the sub-assembly board:

![Over-voltage protection circuit - Repurposed 3](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-12-over-voltage-protection-circuit-repurposed-03-IMG_0155-20240325.JPG)

Here is a view of the bottom of the main over-voltage protection board:

![Over-voltage protection circuit - Repurposed 4](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-13-over-voltage-protection-circuit-repurposed-04-IMG_0149-20240325.JPG)

Here is a couple more images of the populated over-voltage protection board, with the second image having the LED temporarily removed from the socket so the label on the PNP transistor is legible:

![Over-voltage protection circuit - Repurposed 5](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-14-over-voltage-protection-circuit-repurposed-05-IMG_0152-20240325.JPG)

![Over-voltage protection circuit - Repurposed 6](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-15-over-voltage-protection-circuit-repurposed-06-IMG_0154-20240325.JPG)

The completed over-voltage protection device, including the four in-series solar-battery input terminal blocks sub-assembly installed:

![Over-voltage protection circuit - Repurposed 7](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-16-over-voltage-protection-circuit-repurposed-07-IMG_0156-20240325.JPG)

The bottom of the four in-series solar-battery input terminal blocks sub-assembly, showing the electrical tape insulation to ensure the solder pads of the main over-voltage protection board does not cause a short circuit for any of the solar-battery units:

![Over-voltage protection circuit - Repurposed 8](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-25-over-voltage-protection-circuit-repurposed-08-IMG_0175-20240326.JPG)

Next, it's time to create our power-on bidirectional LED indicator.

First, solder a bidirectional LED and 1K Ohm resistor in series, and then bend the LED leads just below the solder-mounting bulges in the leads at 90 degrees, which is approximately the correct height for the LED to protrude throught the solar-battery enclosure hole which will be drilled shortly:

![1.2V Solar Battery Lights - Power on-off bidirectional LED plus 1K resistor](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-18-power-on-off-polar-bidirectional-led-plus-1k-resistor-IMG_0160-20240325.JPG)

Here are the lengths of the silicon 22 AWG wires which will result in a comforable fit within the solar-battery enclosure when assembled:

![1.2V Solar Battery Lights - Power on-off bidirectional LED plus 1K resistor wire lengths](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-21-power-on-off-polar-bidirectional-led-plus-1k-resistor-wire-lengths-IMG_0165-20240325.JPG)

Here is the power-on bidirectional LED indicator fully-assembled with the wires:

![1.2V Solar Battery Lights - Power on-off bidirectional LED plus 1K resistor wire assembly with lengths](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-22-power-on-off-polar-bidirectional-led-plus-1k-resistor-wire-assembly-with-lengths-IMG_0166-20240325.JPG)

Here is the power-on bidirectional LED indicator with wires attached to the "L1" and "L2" solder pads:

N.B.: This is actually an older picture, prior to determining that the blue wire needs to be approximately an inch longer than the yellow wire to provide a comfortable fit in the completed solar-battery enclosure - the subsequent picture shows the current wire lengths and locations.

![1.2V Solar Battery Lights - Power on-off bidirectional LED plus 1K resistor wire assembly attached to PCB](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-19-power-on-off-polar-bidirectional-led-plus-1k-resistor-attached-to-pcb-IMG_0163-20240325.JPG)

Here is the power-on bidirectional LED indicator fully-installed.  The bidirectional LED will actually reside in the middle of the three "AA" battery locations, inserted through the 3 MM hole will in the enclosre which will be added momentarily:

![1.2V Solar Battery Lights - Electronic modifications completed - single device](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-23-completed-electronic-modifications-single-device-IMG_0168-20240325.JPG)

Here are all four of the modified solar-battery devices, awaiting to be wired in-series to the over-voltage protection circuit and associated waterproof enclosure:

![1.2V Solar Battery Lights - Electronic modifications completed - all four devices](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-24-completed-electronic-modifications-all-four-devices-IMG_0169-20240325.JPG)

Here is the power-on bidirectional LED indicator fully-installed, with a small piece of clear tape holding the bidirectional LED where it will actually reside in the middle of the three "AA" battery locations, inserted through the 3 MM hole will in the enclosre which will be added momentarily.  We can see now why the wires are measured to the lengths identified above - they fit comfortably in the enclosure with the necessary wire bends:

![1.2V Solar Battery Lights - Power on-off bidirectional LED plus 1K resistor wire assembly fitted to case hole](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-20-power-on-off-polar-bidirectional-led-plus-1k-resistor-fitted-to-case-hole-IMG_0164-20240325.JPG)

For completeness: here is the in-parallel 4.2 volt Li-Ion sub-assembly board, including the Schottky diodes and 1 Ohm resistors:

![Over-voltage protection circuit - 4.2V Li-Ion hookup refactored 1](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-over-voltage-protection-IMG_0170-20240326.JPG)

Here is the bottom-side of the in-parallel 4.2 volt Li-Ion sub-assembly board, insulated using a couple layers of electrical tape:

![Over-voltage protection circuit - 4.2V Li-Ion hookup refactored 2](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-over-voltage-protection-IMG_0172-20240326.JPG)

Here are a couple images of the in-parallel 4.2 volt Li-Ion sub-assembly board installed with the over-voltage protection circuit assembly:

![Over-voltage protection circuit - 4.2V Li-Ion hookup refactored 3](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-over-voltage-protection-IMG_0173-20240326.JPG)

![Over-voltage protection circuit - 4.2V Li-Ion hookup refactored 4](/images/analog-FOUND-IT-blingstar-solar-christmas-lights-LED-string-retrofit-over-voltage-protection-IMG_0174-20240326.JPG)

Here are the measurements for drilling the 3 MM hole for the power-on bidirectional LED to be exposed through the bottom of the solar-battery enclosure.  As always: measure twice (or even thrice!) before drill/cut:

![1.2V Solar Battery Lights - Case hole for power on-off bidirectional LED](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-17-case-hole-for-power-on-off-polar-bidirectional-led-IMG_0158-20240325.JPG)

Here is the completed solar-battery assembly, with the power-on bidirectional LED illuminated due to a fully-charged battery and solar cells face-down so device appears to be "in the darkness" thus unit turns "on":

![1.2V Solar Battery Lights - Solar cell updates completed](/images/analog-solar-lights-1.2V-1800mAH-ni-mh-aa--hacking-26-solar-cell-updates-completed-IMG_0176-20240326.JPG)

N.B.: After installing the solar-battery assemblies outside, in the bright sun, placing my hand, or even my hand plus a thick, heavy rag, over the solar cells did not result in the red-green bidirectional power-on LED indicator to turn on.  It is almost as if the solar cells were receiving energy, perhaps in the infra-red or ultra-violet spectrum, through my hand.  I did however discover that if i covered the solar cells with a 4x thick sheet of aluminum foil, that would block energy to the solar cells and the red-green bidirectional power-on LED indicators would illuminate, allowing me to confirm that the power-on button was engaged and the sun and solar cells were indeed charging the Ni-MH batteries.

# "New and improved overvoltage protection" Updates

The new 1.2 volt Ni-MH solar batteries do not appear to hold their voltage as long as the 4.2 volt Li-Ion devices did.

It could be the electronics in the Ni-MH devices are not as power-efficient as the Li-Ion devices, given that the Ni-HM devices actually have a higher Amp-Hour power rating of 1800 mAH vs Li-Ion devices power rating of 1200 mAH.

As a result, using the relay-based over-voltage protection circuit, the Ni-MH batteries were depleted by morning, and that afternoon the back yard LEDs had to be re-started ... this will grow old if necessary every day we want back yard LED lighting.

Under completely clear, blue skies and bright sun mid-afternoon, the highest voltage observed at the back yard LED controllers was approximately 6.2 volts.

![1.2V Solar Battery Lights - batterydiodeovervoltageprotect5 ti tl431 series regulator schematic](/images/analog-TL431-Precision-High-Current-Series-Regulator-01-TI-datasheet-20240414.png)

![1.2V Solar Battery Lights - batterydiodeovervoltageprotect5 bristolwatch youtube series regulator schematic](/images/analog-TL431-Precision-High-Current-Series-Regulator-02-Explained-www.youtube.com--watch--v_R6tbsSQ7J8Q-20240414.png)

![1.2V Solar Battery Lights - batterydiodeovervoltageprotect5 schematic](/images/analog-batterydiodeovervoltageprotect5-schematic-20240415_180800.png)

![1.2V Solar Battery Lights - batterydiodeovervoltageprotect5 pcb top view](/images/analog-batterydiodeovervoltageprotect5-pcb-top-view-20240415_182100.png)

![1.2V Solar Battery Lights - batterydiodeovervoltageprotect5 pcb bottom view mirrored](/images/analog-batterydiodeovervoltageprotect5-pcb-bottom-view-mirrored-20240415_181600.png)

Here is the resultant output darlington emitter voltage for a given input battery voltage - the potentiometer has been adjusted to clamp the output voltage to 4.5 volts maximum:

![1.2V Solar Battery Lights - batterydiodeovervoltageprotect5 breadboard](/images/analog-batterydiodeovervoltageprotect5-breadboard-IMG_0177-20240429.jpeg)

# "Damn the Torpedoes ... FULL SPEED AHEAD !!!" Updates

As shared above: under completely clear, blue skies and bright sun mid-afternoon, the highest voltage observed at the back yard LED controllers was approximately 6.2 volts.

This begs the question: how high can the voltage to the back yard LED controllers go until they fail or otherwise cease working?

In anticipation of turning at least a couple of the spare back yard LED controllers into "smoking holes in the ground", i purchased a few spares from Amazon.

I experienced a few unexpected surprises during this experimentation:  
- The back yard LED controllers can sustain a much higher voltage than anticipated  
- There appears to potentially be a built-in over-voltage protection in the back yard LED controllers, whereby they recover by removing the voltage supply momentarily  

As depicted below:
- A 4.5 volt supply was applied to a step-up / boost voltage converter, which can increase output voltage to the back yard LED controller from 2 to 24 volts  
- The back yard LED controller could sustain 8.11 volts - the LEDs glowed remarkably bright!  
- At approximately 8.58 volts, the back yard LED controller turned off the LEDs  
  - I did not attempt to probe the controller to see if other components were continuing to operate, or if the entire controller board shut-off / shut-down
- The voltage to the back yard LED controller was lowered to 7.05 volts but the LEDs remained shut-off / shut-down  
- I momentarily removed then re-attached power to the back yard LED controller, which now again operational, slightly pulled-down the voltage to 7.02 volts due to current running through the controller and now also the string of LEDs  
- The over-voltage process was repeated more slowly  
  - The voltage to the back yard LED controller was increased to 8.58 volts and the LEDs remained illuminated  
  - At 8.63 volts, the LEDs again turned off  

Here are some images of this experimentation:

![1.2V Solar Battery Lights - no over-voltage protection](/images/analog-batterydiodeovervoltage-no-protect-IMG_0179-20240429.jpeg)

![1.2V Solar Battery Lights - no over-voltage protection](/images/analog-batterydiodeovervoltage-no-protect-IMG_0180-20240429.jpeg)

![1.2V Solar Battery Lights - no over-voltage protection](/images/analog-batterydiodeovervoltage-no-protect-IMG_0181-20240429.jpeg)

![1.2V Solar Battery Lights - no over-voltage protection](/images/analog-batterydiodeovervoltage-no-protect-IMG_0182-20240429.jpeg)

![1.2V Solar Battery Lights - no over-voltage protection](/images/analog-batterydiodeovervoltage-no-protect-IMG_0184-20240429.jpeg)

![1.2V Solar Battery Lights - no over-voltage protection](/images/analog-batterydiodeovervoltage-no-protect-IMG_0185-20240429.jpeg)

I neglected to test if, rather than temporarily removing then re-attaching power to the back yard LED controllers, if significantly lowering the voltage would result in the controller and LEDs to recover, or if power truly had to be momentarily removed (e.g.: due to some sort of latching flip-flop over-voltage protection mechanism.)

Another experiment at a future date ...

Here is an image of the notes captured during the various recent experiments:
- Top-Left: Experiments from testing the non-relay, new and improved over-voltage protection circuit.  We can see that the back yard LED controller ceases to operate when the input voltage is 2.5 volts or lower, and with the potentiometer set to approximately 50%, the TL-431 IC plus BC-517 NPN Darlington transistor would begin clamping the output voltage to 4.5 volts at approximately 6.0 volts input, with nominal 4.8 input volts producing 3.7 volts of output at the Darlington emitter.  
- Top-Center: Experiments from over-voltage testing the back yard LED controller with no over-voltage protections.  
- Lower-Left: I learned the value of keeping a "Maintenance Record" in the waterproof enclosures outside, so notes can be captured when components fail and must be replaced, or unexpected situations occur.  
- Lower-Center and Lower-Right: Notes captured while experimenting with initial installation, monitoring:  
  - The red-green bidirectional power-on LED indicators come morning, after the back yard controller and LEDs ran for their cycle and the solar-battery circuit continued to run through the night
  - Whether or not the back yard LED controller and LEDs would successfully illuminate that evening  

Here is the image of the experimental notes:

![1.2V Solar Battery Lights - no over-voltage protection](/images/analog-batterydiodeovervoltage-no-protect-IMG_0186-20240429.jpeg)

# "Memorial Day Holiday 2024" Updates

One concern which has been nagging at me since researching the signal inverter and "push-pull" or "H-Bridge" LED driver circuit during the "Iteration #4: Just can't leave it alone ..." section above: component tolerances may result in the inverter's two output signals both being on/high for a nano-second, resulting in both sides of the "push-pull" or "H-Bridge" LED driver circuit being on momentarily.

The result here would be essentially short-circuiting the battery power supply.

To be honest, the following circuit which eliminates this momentary short-circuit situation is probably consuming slightly more current than just allowing the short-circuit to occur.  However, under low battery situations, the short-circuit may be enought to zero the voltage and cause the LED controller to restart.

Here are some images of this experimentation:

![Delayed Inverter Schematic](/images/analog-inverterdelayed1-schematic-20240527_102700.png)

![Delayed Inverter Breadboard and Oscilloscope 01](/images/analog-inverterdelayed1-01-IMG_0509-20240527.jpeg)

![Delayed Inverter Breadboard and Oscilloscope 02](/images/analog-inverterdelayed1-02-IMG_0510-20240527.jpeg)

![Delayed Inverter Breadboard and Oscilloscope 03](/images/analog-inverterdelayed1-03-IMG_0511-20240527.jpeg)

![Delayed Inverter Breadboard and Oscilloscope 04](/images/analog-inverterdelayed1-04-IMG_0512-20240527.jpeg)

# "Why didn't I try this sooner - September 2024" Updates

Not really certain of what made me think of trying this, but glad I did.

Out of the blue, I wondered: How many LED strings could one LED controller drive?

The problem was that occassionally, one of the three LED controllers would glitch, most-likely due to a too-low-voltage situation, resulting in that one associated string of LEDs would either not be illuminated, or may be illuminated with one of the "flickering" sequence, versus desired steady-on.

I would have to go outside, open up the waterproof case, try to remember which of the three LED controllers was associated with the misbehaving LED string, invariably choose the wrong LED controller, and end up just resetting all three LED controllers/strings.

If a single LED controller could drive all three LED strings, then there may still be glitches, but there would be only a single LED controller to reset.

This would also have the positive effect of one-third of the quiescent current used since two of the three LED controllers are no longer in the architecture, potentially (slightly) reducing the likelihood of glitches due to too-low-voltage situations.

Turns out, a single LED controller can drive three LED strings with only a 10% reduction in LED voltage peak-to-peak.

Here is an images of this experimentation:

![Delayed Inverter Schematic](/images/analog-single-koopower-led-controller-drives-three-led-strings-IMG_0215-20240906.JPG)

# "Autumnal Equinox 2024" Updates

Have had the single LED controller board driving three (3) LED strings in parallel with generally good results for a month or so now.

One observation is that the LED string furthest away (physically and electrically) from the LED controller board is definitely visibly dimmer than the other two LED strings, due to the relatively long distance of small AWG wire spanning the horizontal distance to the far vertical column on which the LED string resides.

Also, wanted to understand what options might look like to decouple the LED controller board's compute/timing functionality and power supply, from the LED string illumination functionality and power supply.

Finally, wanted to take a closer look at the LED controller board operation, primarily around the question of whether the controller's LED drivers have delayed Push-Pull/H-Bridge signals so no momentary short-circuit of the power rails.

Based on the research, the good news is both the large and small LED controller PCBs' Push-Pull/H-Bridge signals do (yes) have delayed signals so no momentary short-circuit of the power rails.

This was confirmed by inlining a 10 Ohm resistor in the power supply then measuring the voltage across the resistor.  We can see that during the delay time window where neither Push-Pull/H-Bridge signals are "on", the resistor voltage (current) drops to nearly zero.

![xxx](/images/analog-koopower-large-green-led-controller-pcb-oscilloscope-01-IMG_0548-20240915.JPG)

![xxx](/images/analog-koopower-large-green-led-controller-pcb-oscilloscope-05-10-ohm-current-no-pnp-npn-hbridge-IMG_0556-20240916.JPG)

![xxx](/images/analog-koopower-large-green-led-controller-pcb-oscilloscope-06-10-ohm-current-no-pnp-npn-hbridge-IMG_0559-20240916.JPG)

One discovery noted in following image: when there is load on the Push-Pull/H-Bridge signals (a single LED string) the LED drive signals are actually not symmetrically sized.  With a 5 Volt supply voltage (four (4) Ni-MH rechargeable batteries), one of the LED drive signals is 4 Volts and the other LED drive signal is 2 Volts.  Interestingly, the brightness of the LEDs seem pretty similar for both differing LED drive signals.

![xxx](/images/analog-koopower-large-green-led-controller-pcb-oscilloscope-13-no-pnp-npn-hbridge-voltage-IMG_0566-20240916.JPG)

Due to the asymmetic LED drive signals, plus the fact that there is a (small) drive voltage drop when three (3) LED strings are connected in parallel to the LED controller, I was interested in understanding how a small externalized Push-Pull/H-Bridge created from discrete PNP (SS8550) and NPN (SS8050) transistors might work.

![xxx](/images/analog-pushpulldriver5-schematic-02-20240925.png)

![xxx](/images/analog-pushpulldriver5-pcb-top-color-02-20240925.png)

![xxx](/images/analog-pushpulldriver5-pcb-bottom-mirrored-monochrome-02-20240925.png)

The first externalized Push-Pull/H-Bridge iteration uses 1K base resistors with a 10K pullup on the PNP transistors, so the transistors are "driven pretty hard to saturation" condition, with resultant increase in drive signals but also increase in current consumption over the LED controller's values.  

Note that the drive signals are symmetric despite the input signals from the LED controller being asymmetric.  

![xxx](/images/analog-koopower-large-green-led-controller-pcb-oscilloscope-07-10-ohm-current-10k-1k-1k-pnp-npn-hbridge-IMG_0560-20240916.JPG)

![xxx](/images/analog-koopower-large-green-led-controller-pcb-oscilloscope-08-10-ohm-current-10k-1k-1k-pnp-npn-hbridge-IMG_0561-20240916.JPG)

![xxx](/images/analog-koopower-large-green-led-controller-pcb-oscilloscope-12-10k-1k-1k-pnp-npn-hbridge-voltage-IMG_0565-20240916.JPG)

The second externalized Push-Pull/H-Bridge iteration uses 10K base resistors with a 100K pullup on the PNP transistors, so the transistors are "barely driven to saturation" condition, with only a slight increase in drive signals and current consumption over the LED controller's values.

Note that the drive signals are symmetric despite the input signals from the LED controller being asymmetric.  

![xxx](/images/analog-koopower-large-green-led-controller-pcb-oscilloscope-09-10-ohm-current-100k-10k-10k-pnp-npn-hbridge-IMG_0562-20240916.JPG)

![xxx](/images/analog-koopower-large-green-led-controller-pcb-oscilloscope-10-10-ohm-current-100k-10k-10k-pnp-npn-hbridge-IMG_0563-20240916.JPG)

![xxx](/images/analog-koopower-large-green-led-controller-pcb-oscilloscope-11-100k-10k-10k-pnp-npn-hbridge-voltage-IMG_0564-20240916.JPG)

The newer/smaller LED controllers interestingly have double-harmonic LED drive signals, whereby there is a outer-harmonic waveform alternating the high/low voltage values, and when high voltage posesses an inner-harmonic higher frequency alternating waveform.

Note also the same asymmetric LED drive signals.

![xxx](/images/analog-koopower-small-green-led-controller-pcb-oscilloscope-01-IMG_0552-20240915.JPG)

![xxx](/images/analog-koopower-small-green-led-controller-pcb-oscilloscope-02-IMG_0553-20240915.JPG)

![xxx](/images/analog-koopower-small-green-led-controller-pcb-oscilloscope-03-IMG_0554-20240915.JPG)

![xxx](/images/analog-koopower-small-green-led-controller-pcb-oscilloscope-04-IMG_0555-20240915.JPG)

So ... this research shows that the LED controller PCBs and firmware are well-designed with delayed internal Push-Pull/H-Bridge signals so no momentary short-circuit of the power rails, and although the LED drive signals have asymmetric voltage values (which do not appear to affect the LED brilliance) we can successfully add externalized Push-Pull/H-Bridge drivers using discrete transistors and other components.

And this is where the research brings us to the classic "We can, but should we?" question.

Again, the largest concern with placing three (3) LED strings in parallel, driven by a single LED controller board (with no externalized Push-Pull/H-Bridge drivers using discrete transistors and other components) is that the far column LED string is visibly dimmer than the other two.  This is primarily due to the relatively long run (~35 feet) of relatively thin wire.  The wire was purchased during the Covid lockdown/disruption, when supply chains world wide were challenged.  The wire must be thin/discreet for aesthetic reasons, and the best that could be done during Covid was a white 4-conductor telephone wire with no ink/printing on the outer jacket.  Unfortunately, each conductor appears to be 0.01 inch in diameter, which according to the american wire guage chart, is 30 AWG, which has 103 Ohms of resistance per 1,000 feet.  So although I have two (2) pairs of two (2) of the four (4) conductors, to result in two composite conductors, that's still a little over 50 Ohms per 1,000 feet.

![xxx](/images/analog-awg-american-wire-gauges-resistance-grid-table-01-20240918.png)

Now that Covid is generally past us, and supply chains are somewhat back to normal, I was able to find double-silver 22 AWG wire at Amazon:

https://www.amazon.com/dp/B0CSJWPWDK?th=1  

![xxx](/images/analog-wire-22-awg-double-silver-amazon-B0CSJWPWDK-01-20240925.png)

22 AWG wire has 16 Ohms per 1,000 feet, resulting in the resistance for the relatively long run of wire to the far column being 1/3rd of the current resistance.

The wire is on order coming directly from China, and just cleared US customs in NY, NY.

An update will be provided once I receive the wire and install it.

# "Join the Resistance" Updates - Late October 2024

As a gentle reminder: the challenge is that the LED controller is located on the ground next to the west-side overhang column, with the east-side LED string connected to the controller over approximately 35 feet of wire.

The wire was run mid-Covid, during significant supply chain disruptions.  At the time, the only wire available which met our aesthetic desires was white four (4) conductor telephone wire with no lettering/labeling ... just white wire, which blends in well against the white overhang trim and columns.

Unfortunately, each of the telephone wire conductors is very small, meaning higher impedance/resistance. I did twist both ends of a pair of conductors (red+green, black+yellow), creating effectively a two (2) conductor "composite" wire, which halves the resistance ... but the resistance is still significant and specific values will be provided shortly.

I have successfully re-wired the east-side column LED string "runner" wire using the 22 AWG wire.

The 22 AWG wire roll is 30 meters (98 feet), of which I used 35 feet for the east-side runner.

Due to the (relatively) low resistance of the wires, the internal resistance of the ohmmeter and probes needs to be accounted for.  Connecting the two probes together, the parasitic (unwanted) resistance measured by the ohmmeter is 2 ohms.

In the following resistance measurements, one end of the wire was insulation-stripped then twisted, and then the resistance was measured at the other end of the wire ... thus the total run of copper measured is twice the length of the wire.

The resistance of the entire roll was measured to be 6.4 ohms, minus the 2 ohms of parasitic resistance, resulting in 4.4 ohms.

The 35 foot length of 22 AWG east-side column runner wire was measured to be 3.2 ohms, minus the 2 ohms of parasitic resistance, resulting in 1.2 ohms.  This make sense as this runner is approximately 1/3rd of the entire roll, and so is the resistance.

I had not previously measured the resistance of the telephone wire runner.  Previously, each LED string had it's own LED controller, so even with the higher resistance telephone wire, the LED controllers voltage output was high enough that the difference in brightness of the east-side column LEDs was imperceptible compared to the west-side column or span LEDs.  Now with a single LED controller driving all three (3) LED strings, the voltage output is pulled down lower and the east-side column LED string is visibly dimmer than the others, thus all this activity.

It turns out, even with the "composite" telephone runner configuration, the resistance of the telephone wire (again, one end twisted together, the other end used to measure the twice-length resistance) is 25.4 ohms, minus the 2 ohms of parasitic resistance, yielding 23.4 ohms for the telephone runner.

23.4 ohms versus the now 1.2 ohms using the 22 AWG wire.

The east-side column LED string now has identical brightness to the others.

Finally, I feel it is interesting that throughout this journey, the architecture of the lighting has gone from moderately complex, to very complex, to relatively simple ... with each stage yielding a more pleasing and effective lighting system.

Just proves that often the simplest solution is often the best solution.

# "Another Renewable Power Bank Option" Updates - Early December 2024

Early in this expedition, I had planned on using rechargeable batteries, before going the solar route.

Unfortunately, Nickel-Cadmium (Ni-Cd), the rechargeable battery which I am most familiar with, has power densities which are considerably lower than their alkaline battery counterparts.

However by happenstance, I came across Nickel-Metal Hydride (Ni-MH) rechargeable batteries on Amazon, and they had significantly higher milli-Amp-Hour (mAH) capacities than Ni-Cd of the same size (AA, A, C, D, etc.)

In fact, Ni-MH have approximately the same energy density as Alkaline.

Wikipedia provides a reference for various battery compositions - MegaJoules/Liter (MJ/L)

https://en.wikipedia.org/wiki/Energy_density_Extended_Reference_Table

- Lead-Acid: 0.36  
- Zinc-Manganese (Alkaline): 1.15-1.43  
- Carbon-Zinc: 0.331  
- Nickel-Metal Hydride (Ni-MH): 1.55  
- Nickel-Cadmium (Ni-Cd): 1.08  
- Lithium-Ion (Li-Ion): 0.83-3.6  

Also: https://web.archive.org/web/20090428060954/http://www.allaboutbatteries.com/Battery-Energy.html

![xxx](/images/analog-battery-energy-densities-01-20241208.png)

One difference about Ni-MH batteries: their nominal operating voltage is not 1.5 volts, but rather 1.2 volts.

However this is not a concern as the LED controller operates with any voltage between 3 Volts and 6 Volts.  So rather than using three (3) 1.5 volt batteries in series (4.5 volts total), instead we will use four (4) 1.2 volt batteries in series (4.8 volts total.)

I also discovered that the Rubbermaid line of "Brilliance" plastic storage containers are quite waterproof and the 1.3 cup and 3.2 cup capacities are good sizes for various electronics projects.  They are significantly less expensive than IP-65 through IP-69 rated enclosures.
Up at the time of this treatise, I shared:

_The lighting unit is operated by three "AA" batteries, at 4.5 Volts total._  
_In order to wrap around the two outdoor columns, plus across the span crossbeam, I needed a total of three LED lighting units._  
_I wondered: how long can three batteries last with LED lights steady-on for six hours each day._  
_I was somewhat surprised that the batteries actually lasted for about one month._  

Googling: A Duracell "AA" Alkaline battery contains approximately 2600 mAH of energy.

Remembering that at epoch of this expedition, each of the three (3) LED controller and string had their own dedicated set of three (3) Alkaline batteries, providing a net total of 2600 mAH x 3 or 7800 mAH of energy.

On the evening of 12/1, I began an experiment using four (4) "C" Ni-MH batteries, which have 5000 mAH of energy, to power the controller and all three (3) LED strings.

Quick math says that i should get approximately 15-20 days of 6-hour illumination from the quad set of "C" Ni-MH batteries ... I will report back shortly on date when LEDs do not turn on, indicating the "C" batteries are depleted and need a recharge.

Update: The quad set of "C" Ni-MH batteries are still powering the LED controller and string each evening ... it has now been nine (9) evenings of 6-hour illumination.  I will provide an update once the LEDs turn off or fail to turn on.

Update: Unclear why the math is so far off, but the LEDs did not complete the nineth (9th) evening of 6-hour illumination.

Having to change the batteries every week will get old quick, particularly during the bitter cold days of winter.

I will instead use four (4) "D" Ni-MH batteries, which have 10000 mAH of energy, to power the controller and all three (3) LED strings.

As anticipated, the "D" batteries provide a little over two (2) weeks of 6-hour illumination.

Here are images of my Ni-MH power bank:

![xxx](/images/analog-ni-mh-nimh-battery-configuration-no-solar-01-IMG_0218-20241208.JPG)

![xxx](/images/analog-ni-mh-nimh-battery-configuration-no-solar-02-IMG_0219-20241208.JPG)

Update: It's been a few days and I decided to craft a new riser board  to host the LED controller, normally-closed pushbutton switch (to easily reset the LED controller), and terminal blocks to accept the Ni-MH power in and LED string current out.

Here are new, updated images of my Ni-MH power bank:

![xxx](/images/analog-ni-mh-nimh-battery-configuration-no-solar-03-IMG_0222-20241211.JPG)

![xxx](/images/analog-ni-mh-nimh-battery-configuration-no-solar-04-IMG_0223-20241211.JPG)

![xxx](/images/analog-ni-mh-nimh-battery-configuration-no-solar-05-IMG_0224-20241211.JPG)

![xxx](/images/analog-ni-mh-nimh-battery-configuration-no-solar-06-IMG_0225-20241211.JPG)

# "Control is an Illusion" Updates - June 2025

I configure the LEDs to turn on at 5 PM year round, so they will go off at 11 PM.

In the winter time, darkness arrives well before 5 PM, so we get to enjoy the LEDs for the entire evening before retiring for the day.

However in the summer time, darkness does not arrive until 8 or 9 PM, so over half of the time the LEDs are on they are barely visible due to daylight.

Unfortunately the LED controller does not have an adjustable timer, for say two (2) or three (3) hours; there are other LED strings and controllers which have more timer options, such as the sets used in the front of the house (remember "remote control ... really?"), but that would entail a complete refactor of the back yard lighting.

I had some spare time, and decided to research how well Micropython on a Raspberry Pi Pico might be able to replace the OEM LED controller.

Besides something interesting to work on, this would give me total control over how long the LEDs would illuminate each night.

The python code turned out to be relatively straight-forward to construct - please see the "source/pushpulltimer1.py" script, currently configured for a 15 second cycle but easily updated for the needed 24 hour cycle.

The Pico will need the externalized Push-Pull/H-Bridge driver using discrete transistors and other components, to actually drive the LED strings.

The python code spends most of the time "sleeping".

With only the Pico, without the Push-Pull/H-Bridge driver nor LED strings, the current consumption was approximately 30 milliamps:

![xxx](/images/analog-rpipico-pushpull1-current-measure-setup-usb-cable-NOT-connected-to-PC-30mA-30mV-across-1ohm-resistor-IMG_0315-20250624.JPG)

![xxx](/images/analog-rpipico-pushpull1-driver-output-signal-IMG_0314-20250624.JPG)

![xxx](/images/analog-rpipico-pushpull1-dso-close-up-usb-cable-NOT-connected-to-PC-30mA-30mV-across-1ohm-resistor-IMG_0316-20250624.JPG)

The Pico also has a "light sleep" mode which turns off more of the RP2040 hardware but maintains RAM and register state, further reducing the current consumption to approximately 5 to 8 milliamps:

Again, here is the Pico using "sleep" not "light sleep", consuming approximately 30 milliamps of current, using a 10 ohm resistor to measure the supply current:

![xxx](/images/analog-rpipico-lightsleep1-seeed-studio-xiao-rp2040-sleep-10-ohm-5-volt-supply-30-milliamp-supply-IMG_0297-20250416.jpeg)

Here is the Pico using "light sleep", consuming approximately 5 milliamps of current, using a 10 ohm resistor to measure the supply current:

![xxx](/images/analog-rpipico-lightsleep1-seeed-studio-xiao-rp2040-lightsleep-10-ohm-5-volt-supply-5-milliamp-supply-IMG_0296-20250416.jpeg)

When using a 1 ohm resistor to measure the supply current, the current increases slightly to somewhere between 5 and 8 milliamps, with an average of approximately 6.5 milliamps:

![xxx](/images/analog-rpipico-lightsleep1-current-measure-setup-8mA-8mV-across-1ohm-resistor-IMG_0317-20250624.JPG)

![xxx](/images/analog-rpipico-lightsleep1-dso-close-up-8mA-8mV-across-1ohm-resistor-IMG_0318-20250624.JPG)

The Pico controller would also allow me to re-introduce the darkness sensor into the architecture at a nominal increase of expense and complexity.

The next step will be to update the python script for the 24 hour cycle, then test how long four (4) "D" Ni-MH batteries, which have 10000 mAH of energy, can operate a three (3) hour LED string "on" duty-cycle (plus any quiescent current associated with the needed externalized Push-Pull/H-Bridge driver.

![xxx](/images/analog-led-controller-currrent-measure-10-ohm-resistor-IMG_0319-20250625.jpeg)

![xxx](/images/analog-led-controller-currrent-measure-10-ohm-resistor-IMG_0320-20250625.jpeg)

![xxx](/images/analog-led-controller-currrent-measure-10-ohm-resistor-IMG_0321-20250625.jpeg)

![xxx](/images/analog-led-controller-currrent-measure-10-ohm-resistor-IMG_0322-20250625.jpeg)

![xxx](/images/analog-led-controller-currrent-measure-10-ohm-resistor-IMG_0323-20250625.jpeg)

THE END.
